<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>“Linux 内核下包过滤框架——iptables&amp;netfilter” | 科技以人为本</title>
    <meta name="generator" content="VuePress 1.7.1">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-141019448-1"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
      
          gtag('config', 'UA-141019448-1');
      </script>
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2468672938537807" crossorigin="anonymous"></script>
    <meta name="description" content="Human Technology">
    <meta name="baidu-site-verification" content="code-HRrK6kdBX1">
    
    <link rel="preload" href="/assets/css/0.styles.9b71556a.css" as="style"><link rel="preload" href="/assets/js/app.8e0e0aa1.js" as="script"><link rel="preload" href="/assets/js/2.a6173bc2.js" as="script"><link rel="preload" href="/assets/js/75.9fdfa923.js" as="script"><link rel="prefetch" href="/assets/js/10.bf63d664.js"><link rel="prefetch" href="/assets/js/100.8b6e7814.js"><link rel="prefetch" href="/assets/js/101.12571bc9.js"><link rel="prefetch" href="/assets/js/102.0ec2c144.js"><link rel="prefetch" href="/assets/js/103.45c76987.js"><link rel="prefetch" href="/assets/js/104.73a84df9.js"><link rel="prefetch" href="/assets/js/105.8b0d2d39.js"><link rel="prefetch" href="/assets/js/106.4cfe32e3.js"><link rel="prefetch" href="/assets/js/107.4908983f.js"><link rel="prefetch" href="/assets/js/108.6af36aa1.js"><link rel="prefetch" href="/assets/js/109.6d53645a.js"><link rel="prefetch" href="/assets/js/11.bac0faf3.js"><link rel="prefetch" href="/assets/js/110.23ebdfd7.js"><link rel="prefetch" href="/assets/js/111.60d5c47c.js"><link rel="prefetch" href="/assets/js/112.49503319.js"><link rel="prefetch" href="/assets/js/113.29d25b3e.js"><link rel="prefetch" href="/assets/js/114.dccf6373.js"><link rel="prefetch" href="/assets/js/115.bff82fe9.js"><link rel="prefetch" href="/assets/js/116.72a6838a.js"><link rel="prefetch" href="/assets/js/117.9170b58d.js"><link rel="prefetch" href="/assets/js/12.33e09c26.js"><link rel="prefetch" href="/assets/js/13.60cc4d0d.js"><link rel="prefetch" href="/assets/js/14.eed97db5.js"><link rel="prefetch" href="/assets/js/15.6ae7a969.js"><link rel="prefetch" href="/assets/js/16.2e38c5d4.js"><link rel="prefetch" href="/assets/js/17.19e7c2d1.js"><link rel="prefetch" href="/assets/js/18.16864033.js"><link rel="prefetch" href="/assets/js/19.da7a566a.js"><link rel="prefetch" href="/assets/js/20.14ac9209.js"><link rel="prefetch" href="/assets/js/21.cc5be404.js"><link rel="prefetch" href="/assets/js/22.e9dcc3bb.js"><link rel="prefetch" href="/assets/js/23.1bde33ed.js"><link rel="prefetch" href="/assets/js/24.fa89b25a.js"><link rel="prefetch" href="/assets/js/25.ac3f9daa.js"><link rel="prefetch" href="/assets/js/26.8b7e6aac.js"><link rel="prefetch" href="/assets/js/27.36ef5666.js"><link rel="prefetch" href="/assets/js/28.691ac761.js"><link rel="prefetch" href="/assets/js/29.05968c58.js"><link rel="prefetch" href="/assets/js/3.582414ce.js"><link rel="prefetch" href="/assets/js/30.6438cbbe.js"><link rel="prefetch" href="/assets/js/31.81ec08db.js"><link rel="prefetch" href="/assets/js/32.2dd19eaa.js"><link rel="prefetch" href="/assets/js/33.69e66a63.js"><link rel="prefetch" href="/assets/js/34.a5a0702e.js"><link rel="prefetch" href="/assets/js/35.c271aca4.js"><link rel="prefetch" href="/assets/js/36.bf333fde.js"><link rel="prefetch" href="/assets/js/37.7eccff12.js"><link rel="prefetch" href="/assets/js/38.c67af869.js"><link rel="prefetch" href="/assets/js/39.96f71642.js"><link rel="prefetch" href="/assets/js/4.54743092.js"><link rel="prefetch" href="/assets/js/40.0b3e0b70.js"><link rel="prefetch" href="/assets/js/41.1bcb2762.js"><link rel="prefetch" href="/assets/js/42.4041f63b.js"><link rel="prefetch" href="/assets/js/43.495a02be.js"><link rel="prefetch" href="/assets/js/44.fe5c58ba.js"><link rel="prefetch" href="/assets/js/45.f379c293.js"><link rel="prefetch" href="/assets/js/46.407904e0.js"><link rel="prefetch" href="/assets/js/47.bafd502f.js"><link rel="prefetch" href="/assets/js/48.5a65d73f.js"><link rel="prefetch" href="/assets/js/49.74eb5526.js"><link rel="prefetch" href="/assets/js/5.6c7f4d05.js"><link rel="prefetch" href="/assets/js/50.de446c48.js"><link rel="prefetch" href="/assets/js/51.574a2931.js"><link rel="prefetch" href="/assets/js/52.c42ccf35.js"><link rel="prefetch" href="/assets/js/53.9c7bb688.js"><link rel="prefetch" href="/assets/js/54.8c000373.js"><link rel="prefetch" href="/assets/js/55.e5166a06.js"><link rel="prefetch" href="/assets/js/56.ff509d04.js"><link rel="prefetch" href="/assets/js/57.a770d143.js"><link rel="prefetch" href="/assets/js/58.de9195e5.js"><link rel="prefetch" href="/assets/js/59.52224ccd.js"><link rel="prefetch" href="/assets/js/6.bb33fed3.js"><link rel="prefetch" href="/assets/js/60.9f0ecb96.js"><link rel="prefetch" href="/assets/js/61.c30ea24c.js"><link rel="prefetch" href="/assets/js/62.1401f6fa.js"><link rel="prefetch" href="/assets/js/63.f24d9359.js"><link rel="prefetch" href="/assets/js/64.97cd222c.js"><link rel="prefetch" href="/assets/js/65.c72ba793.js"><link rel="prefetch" href="/assets/js/66.c5435b35.js"><link rel="prefetch" href="/assets/js/67.d03ecab7.js"><link rel="prefetch" href="/assets/js/68.34869b46.js"><link rel="prefetch" href="/assets/js/69.dd508d6b.js"><link rel="prefetch" href="/assets/js/7.03daa1b7.js"><link rel="prefetch" href="/assets/js/70.3f57fee4.js"><link rel="prefetch" href="/assets/js/71.4e31f464.js"><link rel="prefetch" href="/assets/js/72.5e57edff.js"><link rel="prefetch" href="/assets/js/73.57967895.js"><link rel="prefetch" href="/assets/js/74.a736c83a.js"><link rel="prefetch" href="/assets/js/76.1578ef77.js"><link rel="prefetch" href="/assets/js/77.377addae.js"><link rel="prefetch" href="/assets/js/78.69ab69eb.js"><link rel="prefetch" href="/assets/js/79.572132c0.js"><link rel="prefetch" href="/assets/js/8.01e8181d.js"><link rel="prefetch" href="/assets/js/80.6d44b314.js"><link rel="prefetch" href="/assets/js/81.f5563326.js"><link rel="prefetch" href="/assets/js/82.8821f6e9.js"><link rel="prefetch" href="/assets/js/83.b0ae1cb6.js"><link rel="prefetch" href="/assets/js/84.82d6fbfb.js"><link rel="prefetch" href="/assets/js/85.6042933a.js"><link rel="prefetch" href="/assets/js/86.308668ff.js"><link rel="prefetch" href="/assets/js/87.bbe9cb4e.js"><link rel="prefetch" href="/assets/js/88.079b02d5.js"><link rel="prefetch" href="/assets/js/89.c214e89b.js"><link rel="prefetch" href="/assets/js/9.6a581cd3.js"><link rel="prefetch" href="/assets/js/90.86ff277a.js"><link rel="prefetch" href="/assets/js/91.56c54e65.js"><link rel="prefetch" href="/assets/js/92.e236f7d9.js"><link rel="prefetch" href="/assets/js/93.4bef7a99.js"><link rel="prefetch" href="/assets/js/94.03b422c9.js"><link rel="prefetch" href="/assets/js/95.a31ed3ac.js"><link rel="prefetch" href="/assets/js/96.c29e6b8f.js"><link rel="prefetch" href="/assets/js/97.cee98ba6.js"><link rel="prefetch" href="/assets/js/98.718e810d.js"><link rel="prefetch" href="/assets/js/99.f74104de.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b71556a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">科技以人为本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/索引/Search.html" class="nav-link">
  Google站内搜索
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/素材/211004_linux内核下包过滤框架_iptables_netfilter.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/索引/Search.html" class="nav-link">
  Google站内搜索
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/素材/211004_linux内核下包过滤框架_iptables_netfilter.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>“Linux 内核下包过滤框架——iptables&amp;netfilter”</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#iptables-netfilter" class="sidebar-link">iptables &amp; netfilter</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_1、简介" class="sidebar-link">1、简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_2、iptables-基础" class="sidebar-link">2、iptables 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_2-1、链" class="sidebar-link">2.1、链</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_2-2、表" class="sidebar-link">2.2、表</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_2-3、规则" class="sidebar-link">2.3、规则</a></li></ul></li><li><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3、使用" class="sidebar-link">3、使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-1、规则查询" class="sidebar-link">3.1、规则查询</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-2、规则管理" class="sidebar-link">3.2、规则管理</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-3、基本匹配条件" class="sidebar-link">3.3、基本匹配条件</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-3、扩展匹配条件" class="sidebar-link">3.3、扩展匹配条件</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-4、黑白名单机制" class="sidebar-link">3.4、黑白名单机制</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-5、自定义链" class="sidebar-link">3.5、自定义链</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-6、网络防火墙" class="sidebar-link">3.6、网络防火墙</a></li><li class="sidebar-sub-header"><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_3-7、动作总结" class="sidebar-link">3.7、动作总结</a></li></ul></li><li><a href="/%E7%B4%A0%E6%9D%90/211004_linux%E5%86%85%E6%A0%B8%E4%B8%8B%E5%8C%85%E8%BF%87%E6%BB%A4%E6%A1%86%E6%9E%B6_iptables_netfilter.html#_4、总结" class="sidebar-link">4、总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="iptables-netfilter"><a href="#iptables-netfilter" class="header-anchor">#</a> iptables &amp; netfilter</h2> <h2 id="_1、简介"><a href="#_1、简介" class="header-anchor">#</a> 1、简介</h2> <p>netfilter/iptables（下文中简称为 iptables）组成 Linux 内核下的包过滤防火墙，完成封包过滤、封包重定向和网络地址转换（NAT）等功能。]</p> <p>iptabels 其实不是真正的防火墙, netfilter 才是防火墙真正的安全框架（framework），netfilter 位于内核空间。iptables 其实是一个命令行工具，位于用户空间，我们用这个工具操作真正的框架。</p> <p>Netfilter 是 Linux 操作系统核心层内部的一个数据包处理模块，它具有如下功能：</p> <ul><li>网络地址转换 (Network Address Translate)</li> <li>数据包内容修改</li> <li>数据包过滤的防火墙功能</li></ul> <h2 id="_2、iptables-基础"><a href="#_2、iptables-基础" class="header-anchor">#</a> 2、iptables 基础</h2> <p>iptatble 是按规则来办事的，当数据包与规则匹配时，iptables 就根据规则所定义的方法来处理这些数据包，如放行（accept）、拒绝（reject）和丢弃（drop）等。配置防火墙的主要工作就是添加、修改和删除这些规则。</p> <p>netfilter 才是真正的防火墙，它是内核的一部分，所以，如果我们想要防火墙能够达到” 防火” 的目的，则需要在内核中设置关卡，所有进出的报文都要通过这些关卡，经过检查后，符合放行条件的才能放行，符合阻拦条件的则需要被阻止，于是，就出现了 input 关卡和 output 关卡，而这些关卡在 iptables 中不被称为” 关卡”, 而被称为” 链”。</p> <p><img src="https://img2.tuicool.com/UB3Mzqj.jpg!web" alt="img"></p> <p>iptatbles 中不仅有 <code>input</code> 、 <code>output</code> 关卡，还有 <code>prerouting</code> 、 <code>forward</code> 、 <code>postrouting</code> ，当我们启用了防火墙功能时，报文需要经过如下关卡，也就是说，根据实际情况的不同，报文经过” 链” 可能不同。如果报文需要转发，那么报文则不会经过 input 链发往用户空间，而是直接在内核空间中经过 forward 链和 postrouting 链转发出去的。</p> <p><img src="https://img2.tuicool.com/EvqUFru.jpg!web" alt="img"></p> <h3 id="_2-1、链"><a href="#_2-1、链" class="header-anchor">#</a> 2.1、链</h3> <p>防火墙的作用就在于对经过的报文匹配” 规则”，然后执行对应的” 动作”, 所以，当报文经过这些关卡的时候，则必须匹配这个关卡上的规则，但是，这个关卡上可能不止有一条规则，而是有很多条规则，当我们把这些规则串到一个链条上的时候，就形成了” 链”。</p> <p>这样来说，把他们称为” 链” 更为合适，每个经过这个” 关卡” 的报文，都要将这条” 链” 上的所有规则匹配一遍，如果有符合条件的规则，则执行规则对应的动作。</p> <p><img src="https://img2.tuicool.com/M7V3uaZ.jpg!web" alt="img"></p> <h3 id="_2-2、表"><a href="#_2-2、表" class="header-anchor">#</a> 2.2、表</h3> <p>具有相同功能规则的集合叫做 “表”，iptables 定义来 4 种表，每种表对应了不同的功能，即我们定义的规则都逃脱不了这 4 种功能的范围。</p> <ul><li>filter 表：过滤功能，防火墙；内核模块：iptable_filter</li> <li>nat 表：网络地址转换功能；内核模块：iptable_nat</li> <li>mangle 表：拆解报文，修改，并重新封装功能；内核模块：iptable_mangle</li> <li>raw 表：关闭 nat 表上启用的连接追踪机制；内核模块：iptatble_raw</li></ul> <p>需要注意的是，某些 “链” 注定 不会包含“某类规则”，表链的对应关系如下：</p> <p><img src="https://img0.tuicool.com/A7Z36jN.png!web" alt="img"></p> <p>综合上面描述，数据包经过防火墙的流程总结为下：</p> <p><img src="https://img0.tuicool.com/zuIjamZ.jpg!web" alt="img"></p> <p>如果想要 linux 主机支持转发，则需要开启内核的 IP_FORWARD 功能，可以临时修改对应文件 / proc/sys/net/ipv4/ip_forward。</p> <p>在写 Iptables 规则的时候，要时刻牢记这张路由次序图，灵活配置规则。</p> <h3 id="_2-3、规则"><a href="#_2-3、规则" class="header-anchor">#</a> 2.3、规则</h3> <p>根据指定的匹配条件来尝试匹配每个流经此处的报文，一旦匹配成功，则由规则后面指定的处理动作进行处理。</p> <p>匹配条件分为</p> <p>基本匹配条件：源 IP、目的 IP 等</p> <p>扩展匹配条件：源端口、目的端口等</p> <p>处理动作（在 iptatbles 中被称为 target）：</p> <ul><li>ACCEPT：允许数据包通过</li> <li>DROP：丢弃数据包，不给任何回应信息</li> <li>REJECT：拒绝数据包通过，必要时发送一个响应信息</li> <li>SNAT：源地址转换，解决内网用户用同一个公网地址上网的问题</li> <li>MASOUERADE：SNAT 的一种特殊形式，适用于动态的、临时会变的 ip 上</li> <li>DNAT：目的地址转换</li> <li>REDIRECT：在本机做端口映射</li> <li>LOG：在 / var/log/messages 文件中记录日志信息，然后将数据包传递给下一条规则。</li></ul> <h2 id="_3、使用"><a href="#_3、使用" class="header-anchor">#</a> 3、使用</h2> <h3 id="_3-1、规则查询"><a href="#_3-1、规则查询" class="header-anchor">#</a> 3.1、规则查询</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>#查看对应表所有规则,省略表名默认为filter表
iptables -t 表名 -L

#指定链的规则,-v：详细信息 -n：直接显示IP地址 --line-numbers：显示规则序号 -x：显示计数器的精确值 
iptables --line-numbers -t 表名 -nvxL 链名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-2、规则管理"><a href="#_3-2、规则管理" class="header-anchor">#</a> 3.2、规则管理</h3> <p>添加规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>命令语法：iptables -t 表名 -A 链名 匹配条件 -j 动作
示例：iptables -t filter -A INPUT -s 192.168.1.146 -j DROP

-I：在对应链开头添加规则
-A：在末尾添加规则


规则是按照顺序执行的,添加时候可以指定规则序号,这样就可以在任意位置插入规则了.

命令语法：iptables -t 表名 -I 链名 规则序号 匹配条件 -j 动作
示例：iptables -t filter -I INPUT 5 -s 192.168.1.146 -j REJECT

---设置默认动作---
命令语法：iptables -t 表名 -P 链名 动作
示例：iptables -t filter -P FORWARD ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>删除规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>命令语法：iptables -t 表名 -D 链名 规则序号
示例：iptables -t filter -D INPUT 3

---按照具体匹配条件与动作删除规则--
命令语法：iptables -t 表名 -D 链名 匹配条件 -j 动作
示例：iptables -t filter -D INPUT -s 192.168.1.146 -j DROP
-F：清空对应链的规则，如果省略链名表示删除表中所有规则
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>修改规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>---规则原本的匹配条件不可省略!如果省略,源地址会变成0.0.0.0/0,此时如果是拒绝动作,那么ssh就断掉了---
命令语法：iptables -t 表名 -R 链名 规则序号 规则原本的匹配条件 -j 动作
示例：iptables -t filter -R INPUT 3 -s 192.168.1.146 -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>保存规则</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>---保存在/etc/sysconfig/iptables文件中
service iptables save 或
iptables-save &gt; /etc/sysconfig/iptables

---从文件中重新载入规则
iptatbles-restore &lt; /etc/sysconfig/iptables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-3、基本匹配条件"><a href="#_3-3、基本匹配条件" class="header-anchor">#</a> 3.3、基本匹配条件</h3> <p>当规则中同时存在多个匹配条件时, 多个条件之间默认存在 “与” 的关系.</p> <ul><li><p>-s: 指定源 ip, 多个 ip 用逗号隔开, 也可以指定一个网段</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -t filter -I INPUT -s 192.168.1.111,192.168.1.118 -j DROP
iptables -t filter -I INPUT -s 192.168.1.0/24 -j ACCEPT
iptables -t filter -I INPUT ! -s 192.168.1.0/24 -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>-d: 匹配目标地址, 用法和 - s 一样</p></li> <li><p>-p: 匹配报文协议类型, 可以匹配的协议类型 tcp、udp、udplite、icmp、esp、ah、sctp 等</p></li> <li><p>-i: 匹配报文从哪个网卡接口流入本机, 由于匹配条件只是用于匹配报文流入的网卡，所以在 OUTPUT 链与 POSTROUTING 链中不能使用此选项</p></li> <li><p>-o: 匹配报文从哪个网卡接口流出本机</p></li></ul> <h3 id="_3-3、扩展匹配条件"><a href="#_3-3、扩展匹配条件" class="header-anchor">#</a> 3.3、扩展匹配条件</h3> <ul><li><p>tcp 扩展模块</p> <p>常用的扩展匹配条件如下：</p> <p>-p tcp -m tcp –-sport 用于匹配 tcp 协议报文的源端口，可以使用冒号指定一个连续的端口范围</p> <p>-p tcp -m tcp –-dport 用于匹配 tcp 协议报文的目标端口，可以使用冒号指定一个连续的端口范围</p> <p>--tc-flages 用于匹配 tcp 头部字段标志位, 第一部分为需要匹配哪些标志位, 第二部分为哪些标志位为 1</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -t filter -I INPUT -p tcp -m tcp --dport 22 --tcp-flags SYN,ACK,FIN,RST,URG,PSH SYN -j REJECT
iptables -t filter -I INPUT -p tcp -m tcp --dport 22 --tcp-flags SYN,ACK,FIN,RST,URG,PSH SYN -j REJECT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>--syn 相当于使用”–tcp-flags SYN,RST,ACK,FIN SYN</p></li> <li><p>udp 模块</p> <p>当使用扩展匹配条件时，如果未指定扩展模块，iptables 会默认调用与”-p” 对应的协议名称相同的模块，所以，当使用”-p udp” 时，可以省略”-m udp”.udp 只有 sport 和 dport 两个匹配条件</p></li> <li><p>mutiport 扩展模块</p> <p>常用的扩展匹配条件如下：</p> <p>-p tcp -m multiport –-sports 用于匹配报文的源端口，可以指定离散的多个端口号, 端口之间用” 逗号” 隔开</p> <p>-p udp -m multiport –-dports 用于匹配报文的目标端口，可以指定离散的多个端口号，端口之间用” 逗号” 隔开</p></li> <li><p>iprange 模块</p> <p>包含的扩展匹配条件如下</p> <p>-m iprange –-src-range：指定连续的源地址范围, 用 <code>-</code> 指定一个连续的范围</p> <p>-m iprange -–dst-range：指定连续的目标地址范围</p></li> <li><p>string 模块</p> <p>使用 string 扩展模块，可以指定要匹配的字符串，如果报文中包含对应的字符串，则符合匹配条件, 常用扩展匹配条件如下</p> <p>–-algo：指定对应的匹配算法，可用算法为 bm、kmp，此选项为必需选项。</p> <p>–-string：指定需要匹配的字符串</p></li> <li><p>time 模块</p> <p>常用扩展匹配条件如下</p> <p>–-timestart：用于指定时间范围的开始时间，不可取反</p> <p>–-timestop：用于指定时间范围的结束时间，不可取反</p> <p>–-weekdays：用于指定” 星期几”，可取反</p> <p>–-monthdays：用于指定” 几号”，可取反</p> <p>–-datestart：用于指定日期范围的开始日期，不可取反</p> <p>–-datestop：用于指定日期范围的结束时间，不可取反</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -t filter -I OUTPUT -p tcp --dport 80 -m time --timestart 09:00:00 --timestop 19:00:00 -j REJECT
iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --weekdays 6,7 -j REJECT
iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --monthdays 22,23 -j REJECT
iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --weekdays 5 --monthdays 22,23,24,25,26,27,28 -j REJECT
iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --datestart 2017-12-24 --datestop 2017-12-27 -j REJECT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>connlimit 模块</p> <p>使用 connlimit 扩展模块，可以限制每个 IP 地址同时链接到 server 端的链接数量，注意：我们不用指定 IP，其默认就是针对” 每个客户端 IP”，即对单 IP 的并发连接数限制</p> <p>–-connlimit-above：单独使用此选项时，表示限制每个 IP 的链接数量。</p> <p>–-connlimit-mask：此选项不能单独使用，在使用–connlimit-above 选项时，配合此选项，则可以针对” 某类 IP 段内的一定数量的 IP” 进行连接数量的限制</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 2 -j REJECT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>limit 模块</p> <p>如果我想要限制单位时间内流入的包的数量，就能用 limit 模块, 我们可以以秒为单位进行限制，也可以以分钟、小时、天作为单位进行限制</p> <p>常用的扩展匹配条件如下</p> <p>–-limit-burst：类比” 令牌桶” 算法，此选项用于指定令牌桶中令牌的最大数量</p> <p>–-limit：类比” 令牌桶” 算法，此选项用于指定令牌桶中生成新令牌的频率，可用时间单位有 second、minute 、hour、day。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -t filter -I INPUT -p icmp -m limit --limit-burst 3 --limit 10/minute -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>icmp 模块</p> <p>–-icmp-type：匹配 icmp 报文的具体类型, 可以使用 type/code 和 description 两种方式表示</p> <p><img src="https://img1.tuicool.com/NZRjIv.jpg!web" alt="img"></p></li> <li><p>state 模块</p> <p>问题: 怎样判断这些报文是为了回应我们之前发出的报文，还是主动向我们发送的报文呢？</p> <p>state 模块可以让 iptables 实现” 连接追踪” 机制,” 连接” 其中的报文可以分为 5 种状态，报文状态可以为 NEW、ESTABLISHED、RELATED、INVALID、UNTRACKED.</p> <p>--state</p></li></ul> <h3 id="_3-4、黑白名单机制"><a href="#_3-4、黑白名单机制" class="header-anchor">#</a> 3.4、黑白名单机制</h3> <p>前文中一直在强调一个概念：报文在经过 iptables 的链时，会匹配链中的规则，遇到匹配的规则时，就执行对应的动作，如果链中的规则都无法匹配到当前报文，则使用链的默认策略（默认动作），链的默认策略通常设置为 ACCEPT 或者 DROP。</p> <p>所以，当链的默认策略为 ACCEPT 时，链中的规则对应的动作应该为 DROP 或者 REJECT，表示只有匹配到规则的报文才会被拒绝，没有被规则匹配到的报文都会被默认接受，这就是” 黑名单” 机制。</p> <p>同理，当链的默认策略为 DROP 时，链中的规则对应的动作应该为 ACCEPT，表示只有匹配到规则的报文才会被放行，没有被规则匹配到的报文都会被默认拒绝，这就是” 白名单” 机制。</p> <p>在对应的链中没有设置任何规则时，这样使用默认策略为 DROP 是非常不明智的，因为管理员也会把自己拒之门外，即使对应的链中存在放行规则，当我们不小心使用”iptables -F” 清空规则时，放行规则被删除，则所有数据包都无法进入，这个时候就相当于给管理员挖了个坑，所以，我们如果想要使用” 白名单” 的机制，最好将链的默认策略保持为”ACCEPT”，然后将” 拒绝所有请求” 这条规则放在链的尾部，将” 放行规则” 放在前面，这样做，既能实现” 白名单” 机制，又能保证在规则被清空时，管理员还有机会连接到主机</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -P INPUT ACCEPT
iptabels -I INPUT -p tcp --dport 22 -j ACCEPT
iptabels -I INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3-5、自定义链"><a href="#_3-5、自定义链" class="header-anchor">#</a> 3.5、自定义链</h3> <p>当默认链中的规则非常多时，不方便我们管理。</p> <p>想象一下，如果 INPUT 链中存放了 200 条规则，这 200 条规则有针对 httpd 服务的，有针对 sshd 服务的，有针对私网 IP 的，有针对公网 IP 的，假如，我们突然想要修改针对 httpd 服务的相关规则，难道我们还要从头看一遍这 200 条规则，找出哪些规则是针对 httpd 的吗？这显然不合理。</p> <p>但是需要注意的是，自定义链并不能直接使用，而是需要被默认链引用才能够使用.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>--创建自定义链
iptables -t filter -N IN_WEB

--引用自定义链
iptables -t filter -I INPUT -p tcp --dport 80 -j IN_WEB

--重命名自定义链
iptables -E IN_WEB WEB

--删除自定义链
删除自定义链需要满足两个条件
1、自定义链没有被引用
2、自定义链中没有任何规则

iptables -D INPUT 1
iptables -F WEB
iptables -X WEB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_3-6、网络防火墙"><a href="#_3-6、网络防火墙" class="header-anchor">#</a> 3.6、网络防火墙</h3> <p>防火墙从逻辑上讲，可以分为主机防火墙与网络防火墙。</p> <p>主机防火墙：针对于单个主机进行防护。</p> <p>网络防火墙：往往处于网络入口或边缘，针对于网络入口进行防护，服务于防火墙背后的本地局域网。</p> <p>iptables 都是作为主机防火墙的角色出现的, 如果想要使用 iptables 充当网络防火墙，iptables 所在的主机则需要处于网络入口处, 网络防火墙主要职责就是 “过滤并转发”, 所以规则只能定义在 FORWARD 链中.</p> <p><img src="https://img1.tuicool.com/IFBNz2.jpg!web" alt="img"></p> <p>上图中把 C 主机的网关指向 B 主机网卡 1 的 IP,A 主机网关设为 B 网卡 2 的地址.</p> <p>A ping 10.1.0.1 是 ping 不通的, A 主机通过路由表得知，发往 10.1.0.0/16 网段的报文的网关为 B 主机，当报文达到 B 主机时，B 主机发现 A 的目标为 10.1.0.1，而自己的 IP 是 10.1.0.3，这时，B 主机则需要将这个报文转发给 10.1.0.1（也就是 C 主机），但是，Linux 主机在默认情况下，并不会转发报文，如果想要让 Linux 主机能够转发报文，需要额外的设置，这就是为什么 10.1.0.1 没有回应的原因.</p> <p>A ping 10.1.0.3 可以 ping 通: 当报文到达 B 时, B 主机发现自己既是 192.168.1.146 又是 10.1.0.3，所以，B 主机就直接回应了 A 主机，并没有将报文转发给谁，所以 A 主机得到了 10.1.0.3 的回应。</p> <p>临时生效: 把 / proc/sys/net/ipv4/ip_forward 文件内容设置为 1 表示支持转发报文.</p> <p>永久生效:/etc/sysctl.conf 添加 net.ipv4.ip_forward=1</p> <p>此时就可以 ping 通了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#如果想要iptables作为网络防火墙，iptables所在主机开启核心转发功能，以便能够转发报文。
#使用如下命令查看当前主机是否已经开启了核心转发，0表示为开启，1表示已开启
cat /proc/sys/net/ipv4/ip_forward
#使用如下两种方法均可临时开启核心转发，立即生效，但是重启网络配置后会失效。
方法一：echo 1 &gt; /proc/sys/net/ipv4/ip_forward
方法二：sysctl -w net.ipv4.ip_forward=1
#使用如下方法开启核心转发功能，重启网络服务后永久生效。
配置/etc/sysctl.conf文件（centos7中配置/usr/lib/sysctl.d/00-system.conf文件），在配置文件中将 net.ipv4.ip_forward设置为1
 
#由于iptables此时的角色为&quot;网络防火墙&quot;，所以需要在filter表中的FORWARD链中设置规则。
#可以使用&quot;白名单机制&quot;，先添加一条默认拒绝的规则，然后再为需要放行的报文设置规则。
#配置规则时需要考虑&quot;方向问题&quot;，针对请求报文与回应报文，考虑报文的源地址与目标地址，源端口与目标端口等。
#示例为允许网络内主机访问网络外主机的web服务与sshd服务。
iptables -A FORWARD -j REJECT
iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT
iptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 80 -j ACCEPT
iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT
iptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 22 -j ACCEPT
 
#可以使用state扩展模块，对上述规则进行优化，使用如下配置可以省略许多&quot;回应报文放行规则&quot;。
iptables -A FORWARD -j REJECT
iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT
iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT
iptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_3-7、动作总结"><a href="#_3-7、动作总结" class="header-anchor">#</a> 3.7、动作总结</h3> <p>网关配置和上面一样.</p> <p><img src="https://img1.tuicool.com/v6JN7zy.jpg!web" alt="img"></p> <ul><li><p>SNAT(服务在外网, 内网主动访问外网)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#主机B
iptables -t nat -A POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source 192.168.1.146
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此时内网主机 ping A 主机就能 ping 通, iptables 会自动维护 NAT 表, 并将响应报文的目标地址转换回来.</p></li> <li><p>DNAT(服务在内网, 外网主动访问内网)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#主机B
iptables -t nat -F
iptables -t nat -I PREROUTING -d 192.168.1.146 -p tcp --dport 3389 -j DNAT --to-destination 10.1.0.6:3389
iptables -t nat -A POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source 192.168.1.146
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>表示报文目标地址为 B 公网 IP, 目标端口为 3389 的报文符合匹配条件, 做 DNAT 转换映射到 10.1.0.6:3389 上.</p> <p>注：理论上只配置 DNAT 规则即可，但是如果在测试时无法正常 DNAT，可以尝试配置对应的 SNAT，此处按照配置 SNAT 的流程进行。</p></li> <li><p>MASQUERADE</p> <p>MASQUERADE 会动态的将源地址转换为可用的 IP 地址，其实与 SNAT 实现的功能完全一致，都是修改源地址，只不过 SNAT 需要指明将报文的源地址改为哪个 IP，而 MASQUERADE 则不用指定明确的 IP，会动态的将报文的源地址修改为指定网卡上可用的 IP 地址.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>iptables -t nat -I POSTROUTING -s 10.1.0.0/16 -o eth0 -j MASQUERADE
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>表示通过外网网卡出去的报文在经过 POSTROUTING 链时，会自动将报文的源地址修改为外网网卡上可用的 IP 地址，这时，即使外网网卡中的公网 IP 地址发生了改变，也能够正常的、动态的将内部主机的报文的源 IP 映射为对应的公网 IP, 可以把 MASQUERADE 理解为动态的、自动化的 SNAT，如果没有动态 SNAT 的需求，没有必要使用 MASQUERADE，因为 SNAT 更加高效。</p></li> <li><p>REDIRECT</p> <p>使用 REDIRECT 动作可以在本机上进行端口映射</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#将本机80端口映射到本机8080端口
iptables -i nat -A PREROUTING -o tcp --dport 80 -j REDIRECT --to-ports 8080
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h2 id="_4、总结"><a href="#_4、总结" class="header-anchor">#</a> 4、总结</h2> <ol><li><p>规则顺序很重要</p> <p>如果报文已经被前面的规则匹配到，IPTABLES 则会对报文执行对应的动作，通常是 ACCEPT 或者 REJECT，报文被放行或拒绝以后，即使后面的规则也能匹配到刚才放行或拒绝的报文，也没有机会再对报文执行相应的动作了（前面规则的动作为 LOG 时除外），所以，针对相同服务的规则，更严格的规则应该放在前面。</p></li> <li><p>当规则中有多个匹配条件时, 条件之间是 “与” 的关系</p></li> <li><p>在不考虑 1 的情况下, 应该将更容易被匹配的规则放在前面</p> <p>比如，你写了两条规则，一条针对 sshd 服务，一条针对 web 服务。假设，一天之内，有 20000 个请求访问 web 服务，有 200 个请求访问 sshd 服务，那么，应该将针对 web 服务的规则放在前面，针对 sshd 的规则放在后面，因为访问 web 服务的请求频率更高。如果将 sshd 的规则放在前面，当报文是访问 web 服务时，sshd 的规则也要白白的验证一遍，由于访问 web 服务的频率更高，白白耗费的资源就更多。</p></li> <li><p>当 IPTABLES 所在主机作为网络防火墙时，在配置规则时，应着重考虑方向性，双向都要考虑，从外到内，从内到外。</p></li> <li><p>在配置 IPTABLES 白名单时，往往会将链的默认策略设置为 ACCEPT，通过在链的最后设置 REJECT 规则实现白名单机制，而不是将链的默认策略设置为 DROP，如果将链的默认策略设置为 DROP，当链中的规则被清空时，管理员的请求也将会被 DROP 掉。</p></li></ol> <p>全文完</p> <p>本文由 <a href="http://ksria.com/simpread" target="_blank" rel="noopener noreferrer">简悦 SimpRead<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 优化，用以提升阅读体验</p> <p>使用了 全新的简悦词法分析引擎 beta，<a href="http://ksria.com/simpread/docs/#/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90%E5%BC%95%E6%93%8E" target="_blank" rel="noopener noreferrer">点击查看<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>详细说明</p> <p><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-0" target="_blank" rel="noopener noreferrer">iptables &amp; netfilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-1" target="_blank" rel="noopener noreferrer">1、简介<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-2" target="_blank" rel="noopener noreferrer">2、iptables 基础<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-3" target="_blank" rel="noopener noreferrer">2.1、链<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-4" target="_blank" rel="noopener noreferrer">2.2、表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-5" target="_blank" rel="noopener noreferrer">2.3、规则<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-6" target="_blank" rel="noopener noreferrer">3、使用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-7" target="_blank" rel="noopener noreferrer">3.1、规则查询<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-8" target="_blank" rel="noopener noreferrer">3.2、规则管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-9" target="_blank" rel="noopener noreferrer">3.3、基本匹配条件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-10" target="_blank" rel="noopener noreferrer">3.3、扩展匹配条件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-11" target="_blank" rel="noopener noreferrer">3.4、黑白名单机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-12" target="_blank" rel="noopener noreferrer">3.5、自定义链<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-13" target="_blank" rel="noopener noreferrer">3.6、网络防火墙<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-14" target="_blank" rel="noopener noreferrer">3.7、动作总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://www.tuicool.com/articles/AfqIz2Q#sr-toc-15" target="_blank" rel="noopener noreferrer">4、总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2021/10/4 下午7:24:23</span></div></footer> <!----> </main> <div class="footer-wrapper footer"><span><a href="https://beian.miit.gov.cn/">豫ICP备20003255号</a></span> <!----></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8e0e0aa1.js" defer></script><script src="/assets/js/2.a6173bc2.js" defer></script><script src="/assets/js/75.9fdfa923.js" defer></script>
  </body>
</html>
