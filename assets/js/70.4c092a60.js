(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{454:function(a,e,n){"use strict";n.r(e);var s=n(42),t=Object(s.a)({},(function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("blockquote",[n("ul",[n("li",[a._v("å› ä¸ºç¬”è€…å¯¹ è®¡ç®—æœºç½‘ç»œ è®¤è¯†æµ…è–„, åŠ ä¸Šå¾ˆå¤šçš„éƒ¨åˆ†éƒ½æ˜¯ç°å­¦ç°å–ï¼Œæ‰€ä»¥ä¸‹è¿°å†…å®¹å¯èƒ½å­˜åœ¨ä¸å…·ä½“äº‹å®ç›¸æ‚–çš„å†…å®¹, æ‰€ä»¥å¦‚æœå‘ç°è¯·åŠ³çƒ¦æŒ‡æ­£æˆ–è®¨è®º! ä¸èƒœæ„Ÿæ¿€.")]),a._v(" "),n("li",[a._v("ä¸‹æ–‡ä¸­å¦‚ä¸‹è¯æ±‡è¡¨è¾¾åŒä¸€ä¸ªæ„æ€ï¼š æ•°æ®å¸§ï¼Œæ•°æ®åŒ…")])])]),a._v(" "),n("p",[a._v("[TOC]")]),a._v(" "),n("h2",{attrs:{id:"èƒŒæ™¯-å’Œ-flannel-è¦è§£å†³çš„é—®é¢˜"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#èƒŒæ™¯-å’Œ-flannel-è¦è§£å†³çš„é—®é¢˜"}},[a._v("#")]),a._v(" èƒŒæ™¯ å’Œ flannel è¦è§£å†³çš„é—®é¢˜")]),a._v(" "),n("p",[a._v("ä» flannel çš„è§’åº¦çœ‹, Kubernetes åªæä¾›äº† CNI æ¥å£, è€Œ flannel è¦å®Œæˆä¸‹å±‚ç½‘ç»œçš„è¿é€šå’Œæ„å»º.")]),a._v(" "),n("p",[a._v("flannel è¦è§£å†³åŸºäº CNI çš„é—®é¢˜åŒ…æ‹¬å¦‚ä¸‹:")]),a._v(" "),n("ol",[n("li",[a._v("åˆ†é…æ¯ä¸ª Pods çš„ç½‘ç»œåœ°å€ (çŸ¥é“æ¯ä¸ª Pods åœ¨å“ª)")]),a._v(" "),n("li",[a._v("è®¾ç½®è™šæ‹Ÿç½‘ç»œè®¾å¤‡, æ¥è´Ÿè´£è™šæ‹Ÿç½‘ç»œè¿é€š (è®©æ•°æ®åŒ…åˆ°è¾¾ æŒ‡å®š Pods çš„ä½ç½®)")])]),a._v(" "),n("p",[a._v("é™¤æ­¤ä¹‹å¤–, å®ƒè¿˜è¦è§£å†³ Kubernetes ç¯å¢ƒä¸‹å¯¹ ç½‘ç»œæ–¹æ¡ˆçš„è¦æ±‚:")]),a._v(" "),n("ol",[n("li",[a._v("æ‰€æœ‰çš„ Pods éƒ½éœ€è¦æœ‰ ç‹¬ç«‹çš„ IP åœ°å€")]),a._v(" "),n("li",[a._v("æ‰€æœ‰çš„ Pods éƒ½éœ€è¦å¯ä»¥å¯¹å¤–å‘åŒ…å¹¶æ¥æ”¶åˆ°å“åº”")]),a._v(" "),n("li",[a._v("åˆç†åˆ’åˆ†å­ç½‘, é¿å… ARP æ³›æ´ªé—®é¢˜.")]),a._v(" "),n("li",[a._v("å¯ä»¥åŠ¨æ€çš„åˆ†é… IP åœ°å€, è€Œä¸æ˜¯é™æ€çš„åœ°å€åˆ†é…")]),a._v(" "),n("li",[a._v("èŠ‚ç‚¹ä¸Šçš„ Pod å¯ä»¥ä¸é€šè¿‡ NAT å’Œå…¶ä»–ä»»ä½•èŠ‚ç‚¹ä¸Šçš„ Pod é€šä¿¡")]),a._v(" "),n("li",[a._v("èŠ‚ç‚¹ä¸Šçš„ä»£ç†ï¼ˆæ¯”å¦‚ï¼šç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ã€kubeletï¼‰å¯ä»¥å’ŒèŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰Podé€šä¿¡")])]),a._v(" "),n("p",[a._v("æ˜ç¡®äº†è¦è§£å†³çš„é—®é¢˜å, éœ€è¦æ¥å†™ä¸€äº›ä»£ç æ¥è§£å†³è¿™äº›é—®é¢˜, flannel é€‰æ‹©äº†æ„å»º overlay ç½‘ç»œçš„æ–¹å¼æ¥è§£å†³ Kubernetes ç½‘ç»œçš„æ­å»ºé—®é¢˜.")]),a._v(" "),n("h2",{attrs:{id:"runtime-æ–¹æ¡ˆè®¾è®¡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#runtime-æ–¹æ¡ˆè®¾è®¡"}},[a._v("#")]),a._v(" runtime æ–¹æ¡ˆè®¾è®¡")]),a._v(" "),n("p",[a._v("flannel å‡ ä¹æ˜¯æœ€æ—©çš„è·¨èŠ‚ç‚¹å®¹å™¨è§£å†³æ–¹æ¡ˆï¼Œflannel æä¾›å¾ˆå¤šç§çš„ç½‘ç»œæ¨¡å¼ï¼Œé™¤äº†ç­‰ä¸‹è¦è¯¦ç»†è®²çš„ "),n("code",[a._v("UDP")]),a._v(" \\ "),n("code",[a._v("VXLAN")]),a._v(" \\ "),n("code",[a._v("Host-Gateway")]),a._v(" è¿™ä¸‰ä¸ªæ¨¡å¼å¤–ï¼Œè¿˜åŒ…æ‹¬å¦‚ä¸‹")]),a._v(" "),n("ul",[n("li",[a._v("å¹³å°ç»‘å®šçš„ç½‘ç»œæ¨¡å¼ ï¼š "),n("code",[a._v("AliVPC")]),a._v(" \\ "),n("code",[a._v("AWSVPC")]),a._v(" \\ "),n("code",[a._v("TencentVPC")]),a._v(" \\ "),n("code",[a._v("GCE Route")])]),a._v(" "),n("li",[n("code",[a._v("IPIP")]),a._v(" \\ "),n("code",[a._v("IPSec")])]),a._v(" "),n("li",[a._v("ä»…é™å•æœºçš„ "),n("code",[a._v("Alloc")])])]),a._v(" "),n("p",[a._v("flannel å°† Pod çš„ CIDR ç½‘æ®µä¸ æœºå™¨ç»‘å®š, ä»è€Œé¿å…ä¸å¿…è¦çš„æ•°æ®åŒ…è½¬å‘.")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-07-arch-CIDR.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3Dcfe46b74291c9e7f895b97cd32ca44fc00e108b4",alt:"img"}})]),a._v(" "),n("h3",{attrs:{id:"tun-backend-udp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tun-backend-udp"}},[a._v("#")]),a._v(" TUN ( backend UDP )")]),a._v(" "),n("blockquote",[n("p",[a._v("åœ¨å…¶ä»–å¤§éƒ¨åˆ†æ–‡ç« é‡Œ, ä»¥åŠ flannel çš„å®˜æ–¹æ–‡æ¡£é‡Œ, éƒ½ä¼šæŠŠè¿™ä¸€é˜¶æ®µç§°ä¸º "),n("code",[a._v("UDP")]),a._v(" ,ä½†ç¬”è€…è®¤ä¸ºè¿™ä¸ªæè¿°æœ‰å¤±å‡†ç¡®æ€§, è¿™é‡Œçš„å…³é”®äº‹å®ä¸Šä¸æ˜¯ UDP, VXLAN ä¹Ÿæ˜¯ä½¿ç”¨ UDP æ¥è¿›è¡Œæ•°æ®åŒ…çš„å››å±‚å°è£…, ç¬”è€…è®¤ä¸ºè¿™ä¸ªæ–¹æ¡ˆçš„æ ¸å¿ƒåœ¨äº TUN è®¾å¤‡. é‚è¿™ä¸€èŠ‚çš„æ ‡é¢˜ç¬”è€…å°†å®ƒå–ä¸º TUN")])]),a._v(" "),n("h4",{attrs:{id:"è®¾è®¡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è®¾è®¡"}},[a._v("#")]),a._v(" è®¾è®¡")]),a._v(" "),n("p",[a._v("æ„å»º overlay ç½‘ç»œ, æœ€ç®€å•çš„æ–¹å¼è‡ªç„¶æ˜¯ä½¿ç”¨ TUN æ¥å°† ä¸‰å±‚ç½‘ç»œ(L3) çš„åŒ…æŠ“ä¸Šæ¥, ç„¶åç”± åº”ç”¨å±‚(L7) é‡æ–°å°åŒ… å†æŠ•é€’. flannel ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„. å¦‚ä¸‹é¢çš„ç¤ºæ„å›¾æ‰€ç¤º,")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-01-arch-TUN.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3Def1dbab972bcb1d0ae85e97232f56693290a3d63",alt:"img"}})]),a._v(" "),n("p",[a._v("æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¼šæœ‰ä¸€ä¸ª flannel çš„ agent å«åš "),n("code",[a._v("flanneld")]),a._v(" , (ä¸‹ä¸€ç« èŠ‚ä¼šä¸“é—¨èŠè¿™ä¸ªæ˜¯å¦‚ä½•é¢„å…ˆé…ç½®åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šçš„, è¿™é‡Œå…ˆä¸“æ³¨åœ¨ Runtime ä¸Š) , è¿™ä¸ª Agent ä¼šè®¾ç½® router å’Œ å¼€å¯ ä¸€ä¸ª tun ç±»å‹çš„ç½‘ç»œè®¾å¤‡ å« "),n("code",[a._v("flannel 0")]),a._v(" .")]),a._v(" "),n("p",[a._v("ç½‘ç»œåŒ…ä» "),n("code",[a._v("Network Namespace")]),a._v(" ä¸­, é€è¿‡ "),n("code",[a._v("veth pair")]),a._v(" æ¥åˆ° "),n("code",[a._v("docker0 (bridge)")]),a._v(" ä¹‹å, æ•°æ®åŒ…çš„ "),n("code",[a._v("ç›®æ ‡ mac åœ°å€")]),a._v(" å·²ç»åˆ°è¾¾ (mac åœ°å€æ˜¯ä¸€æ®µä¸€æ®µæ”¹å˜çš„), å½“å‰æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# current package format\n\n---------------\nmac(L2)\n---------------\nip (L3)\n---------------\nL4 protocal format\n---------------\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br")])]),n("p",[a._v("æ‰€ä»¥ bridge ä¼šå°†è¿™ä¸ªæ•°æ®åŒ…äº¤ç»™ "),n("code",[a._v("Linux åè®®æ ˆ")]),a._v(" æ¥åš L3 å±‚çš„è·¯ç”±, "),n("code",[a._v("Linux åè®®æ ˆ")]),a._v(" å‘ç° æ•°æ®åŒ…ä¸­çš„ "),n("code",[a._v("ç›®æ ‡åœ°å€ IP")]),a._v(" ç¬¦åˆ "),n("code",[a._v("Linux Kernel FIB")]),a._v(" ä¸­çš„è·¯ç”±è§„åˆ™, æ¥ç€ä¼šå°† æ•°æ®åŒ… è½¬å‘ç»™ "),n("code",[a._v("flannel 0 è®¾å¤‡")]),a._v(", è€Œ "),n("code",[a._v("flannel 0")]),a._v(" æ˜¯ tun è®¾å¤‡, åœ¨ æ”¶åˆ° æ•°æ®åŒ…å ä¼šä»¥ "),n("code",[a._v("L3 æ•°æ®åŒ…")]),a._v(" çš„æ ¼å¼å°† æ•°æ®åŒ… å‘ç»™ flanneld ç¨‹åº. å½“å‰æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# current package format\n\n---------------\nip (L3)\n---------------\nL4 protocal format\n---------------\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])]),n("p",[a._v("flanneld ç¨‹åºä¼šè¯»å– æ”¶åˆ°çš„æ•°æ®åŒ… çš„ "),n("code",[a._v("ç›®æ ‡ IP")]),a._v(", æ ¹æ® etcd ä¸­çš„å„ flannel èŠ‚ç‚¹çš„ "),n("code",[a._v("ç½‘æ®µä¿¡æ¯")]),a._v(" åˆ¤æ–­ è¿™ä¸ªæ•°æ®åŒ…è¦å‘ç»™å“ªä¸€ä¸ªå…¶ä»–çš„ flanneld ç¨‹åº.")]),a._v(" "),n("p",[a._v("etcd ä¸­çš„ä¸€ä¸ªç½‘æ®µä¿¡æ¯å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹, æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¼šæœ‰ä¸€ä¸ª flanneld ç¨‹åº, è€Œ etcd ä¸­å®é™…å­˜å‚¨çš„å°±æ˜¯ä¸€ä¸ªç½‘æ®µä¿¡æ¯å¯¹åº”ä¸€ä¸ª flanneld ç¨‹åºçš„ IP åœ°å€.")]),a._v(" "),n("p",[a._v("æ‰€ä»¥ flanneld ç¨‹åºæ ¹æ® etcd ä¸­çš„ "),n("code",[a._v("ç½‘æ®µä¿¡æ¯")]),a._v(" çŸ¥é“äº† æ•°æ®åŒ… çš„æ¥å—è€…åœ¨å“ªä¸ªèŠ‚ç‚¹ä¹‹å, å°±ä¼šå°† æ•°æ®åŒ…ä½¿ç”¨ UDP çš„æ ¼å¼é‡æ–°å°åŒ…, ç„¶åå‘é€ç»™å¯¹åº”èŠ‚ç‚¹çš„ flanneld æ‰€ç›‘å¬çš„ç«¯å£ä¸Š. å½“å‰æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# current package format\n\n---------------\nUDP (L4)\n---------------\nip (L3)\n---------------\nL4 protocal format\n---------------\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-01-arch-TUN.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3Def1dbab972bcb1d0ae85e97232f56693290a3d63",alt:"img"}})]),a._v(" "),n("p",[a._v("æ¥ç€æ•°æ®åŒ…æµç» å½“å‰èŠ‚ç‚¹çš„ eth0 ç½‘å¡å‘é€å‡ºå», å½“å‰æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# current package format\n\n---------------\nMac (L2)\n---------------\nother flanneld ip (L3)\n---------------\nUDP (L4)\n---------------\nip (L3)\n---------------\nL4 protocal format\n---------------\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br")])]),n("p",[a._v("æ¥ç€å¯¹ç«¯çš„ eth0 ç½‘å¡æ¥å—åˆ°æ•°æ®å, å¼€å§‹å°†æ•°æ®åŒ…è§£åŒ…, åœ¨ L4 å±‚å‘ç°æ˜¯ Node B ä¸Šçš„ flanneld ç›‘å¬çš„ç«¯å£, ç„¶åå°† æ•°æ®åŒ…é€è¿‡ socket çš„å½¢å¼ä¼ è¾“ç»™ flanneld, æ¥ç€ flanneld æ”¶åˆ° eth0 ç»™è¿‡æ¥çš„æ•°æ®åŒ…å, å½“å‰æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# current package format\n\n---------------\nip (L3)\n---------------\nL4 protocal format\n---------------\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])]),n("p",[a._v("å°†æ•°æ®åŒ…å†ç»™å› flannel 0 è¿™ä¸ª TUN è®¾å¤‡, TUN è®¾å¤‡ä¼šæŠŠè¿™ä¸ªåŒ…æ”¾å› L3 çš„åè®®æ ˆä¸­, åè®®æ ˆä¼šå»æ ¹æ® Linux Kernel FIB ä¸­çš„å‘½ä¸­è§„åˆ™, å°† æ•°æ®åŒ…å‘é€ ç»™ docker 0 , ç„¶å docker 0 å®Œæˆ ip åˆ° mac åœ°å€çš„è½¬æ¢, å°† æ•°æ®åŒ…ä»å¯¹åº”çš„ veth pair ä¼ è¾“åˆ° "),n("code",[a._v("network namespace")]),a._v(" ä¸­, æ¥ç€åœ¨ Linux çš„åè®®æ ˆ L4 æ‹†åŒ…æ—¶, å°†æ•°æ®åŒ…ç»™åˆ° Biz App. å½“å‰æ•°æ®åŒ…ç»“æ„å¦‚ä¸‹")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("# current package format\n\n---------------\nL4 protocal format\n---------------\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-01-arch-TUN.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3Def1dbab972bcb1d0ae85e97232f56693290a3d63",alt:"img"}})]),a._v(" "),n("p",[a._v("è¿™æ ·å°±æ˜¯ flannel åœ¨ TUN æ¨¡å¼ä¸‹, æ•°æ®åŒ…ä¼ è¾“çš„å…¨è¿‡ç¨‹, å¯ä»¥çœ‹åˆ°ä½¿ç”¨ä¸€ä¸ªè¾ƒä¸ºç®€å•çš„ç»“æ„, ä»¥ overlay çš„å½¢å¼, è§£å†³äº† Kubernetes ç½‘ç»œçš„æ­å»º.")]),a._v(" "),n("h4",{attrs:{id:"ç»“"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç»“"}},[a._v("#")]),a._v(" ç»“")]),a._v(" "),n("p",[a._v("è™½ç„¶ flannel çš„ TUN æ–¹æ¡ˆå­˜åœ¨ä¸€äº›ä¸å°çš„ç¼ºé™·(æ€§èƒ½æ–¹é¢), ä½†å¯ä»¥çœ‹å¾—å‡ºè¿™ä¸ªæ–¹æ¡ˆçš„æ½œåŠ›,")]),a._v(" "),n("ul",[n("li",[a._v("é€šè¿‡ä»¥ èŠ‚ç‚¹ç»´åº¦ çš„ç½‘æ®µåˆ’åˆ†, æ¥é¿å…äº†è¦ç²¾ç¡®æ‰¾åˆ°æ¯ä¸ª IP å¯¹åº”çš„ å®¹å™¨åœ¨å“ªçš„ é—®é¢˜ "),n("s",[a._v("(æ‹¯æ•‘å¤§å…µç‘æ© ğŸ˜ƒ)")]),a._v(", æˆ‘ä»¬åªéœ€è¦çŸ¥é“è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„ç½‘æ®µ, å°±å¯ä»¥çŸ¥é“è¿™ä¸ªæ•°æ®åŒ…è¦å‘åˆ°å“ªä¸ª flannel agent ä¸Š, å‰©ä¸‹çš„ç”± å¯¹åº”èŠ‚ç‚¹å†…éƒ¨è‡ªè¡Œç¡®å®š æ•°æ®åŒ…çš„æ¥æ”¶å®¹å™¨. è™½ç„¶è¿™ä¸ªä¸ä¸€å®šæ˜¯ flannel é¦–åˆ›, å¯èƒ½åœ¨ ä¼ ç»Ÿçš„ VM çš„ç½‘ç»œæ–¹æ¡ˆä¸­ å°±å·²ç»æœ‰. ä½†è¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„è§£å†³æ–¹æ¡ˆ.")])]),a._v(" "),n("p",[a._v("ä¸è¿‡è¿™ä¸ªæ¨¡å¼ä¾æ—§å­˜åœ¨ç¼ºé™·, ä¸»è¦æ˜¯æ€§èƒ½æ–¹é¢, ç”±äºå¤§é‡ä½¿ç”¨äº† TUN ç½‘ç»œè®¾å¤‡, æ¯å‘é€ä¸€ä¸ªæ•°æ®åŒ…æ¯æ¬¡éƒ½ä¼šç»å†ä¸¤æ¬¡ä» "),n("code",[a._v("ç”¨æˆ·æ€")]),a._v(" åˆ° "),n("code",[a._v("å†…æ ¸æ€")]),a._v(" çš„åˆ‡æ¢,")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("  TUN ========> flanneld =======> eth 0\n å†…æ ¸æ€           ç”¨æˆ·æ€             å†…æ ¸æ€\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("è¿™ä¼šé€ æˆä¸å°çš„æ€§èƒ½æŸè€—, æ¥ç€å°è¯•å¯¹è¿™å—åšä¼˜åŒ–.")]),a._v(" "),n("h3",{attrs:{id:"backend-vxlan"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backend-vxlan"}},[a._v("#")]),a._v(" backend VXLAN")]),a._v(" "),n("p",[a._v("å¯ä»¥çœ‹åˆ° åŸºäº TUN çš„æ–¹æ¡ˆå…¶å®å·²ç»è§£å†³é—®é¢˜äº†("),n("s",[a._v("åˆä¸æ˜¯ä¸èƒ½ç”¨ ğŸ˜ƒ")]),a._v("), æ¥ç€éœ€è¦å»ä¼˜åŒ–æ€§èƒ½ä»¥é€‚é…å¯¹æ€§èƒ½æ›´åŠ æ•æ„Ÿçš„åœºæ™¯. TUN æ¨¡å¼ä¸‹çš„é—®é¢˜åœ¨äº åœ¨ç”¨æˆ·æ€ä¸‹, å¯¹ æ•°æ®åŒ…é‡æ–°å°è£…, ä»è€Œå¸¦æ¥çš„æ€§èƒ½é—®é¢˜. é‚£ä¹ˆæ˜¯å¦æœ‰å¯èƒ½å°†è¿™ä¸ªé‡æ–°å°è£…çš„å·¥ä½œåœ¨ å†…æ ¸æ€ ä¸‹å®Œæˆå‘¢? è¿™é‡Œ flannel é€‰æ‹©ä½¿ç”¨ Kernel ä¸­çš„ VXLAN , æ¥ä»£æ›¿åˆšåˆš TUN æ¨¡å¼ çš„å®ç°.åœ¨ç°åœ¨, VXLAN å·²ç»å˜æˆäº†ä¸€ä¸ªæ¨¡å¼æ¶æ„çš„ä»£åè¯, ä¾‹å¦‚ä½ å¯ä»¥ä½¿ç”¨ OVS(open vSwitch) æ¥å®ç°ä¸€ä¸ª VXLAN , ä½†æˆ‘ä»¬è¿™é‡Œè®¨è®ºçš„æ˜¯ Linux Kernel ä¸­çš„ VXLAN å®ç°.")]),a._v(" "),n("h4",{attrs:{id:"è®¾è®¡-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è®¾è®¡-2"}},[a._v("#")]),a._v(" è®¾è®¡")]),a._v(" "),n("p",[a._v("VXLAN é€è¿‡å’Œä¸Šè¿° TUN æ¨¡å¼ç±»ä¼¼çš„ç»“æ„å®ç°äº†ä¸€ä¸ª Overlay ç½‘ç»œ, å®ƒä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªå«åš VTEP (VXLAN Tunnel Endpoint) çš„ agent , è¿™ä¸ª agent è¿è¡Œåœ¨å†…æ ¸æ€ä¸‹. VXLAN æœ‰ç»„æ’­æ¨¡å¼, ä»¥åŠ VNI çš„æ¦‚å¿µ,")]),a._v(" "),n("p",[n("img",{attrs:{src:"http://support.huawei.com/huaweiconnect/enterprise/data/attachment/forum/dm/ecommunity/uploads/2015/1123/16/5652c940898f4.png",alt:"img"}})]),a._v(" "),n("p",[a._v("è€Œè¯»è€…ä»ä¸Šé¢çš„æè¿°é‡Œä¹Ÿçœ‹å¾—åˆ°, flannel ä»…ä»…åªæ˜¯æƒ³é€è¿‡ VXLAN æ€§èƒ½è€Œå·², å¹¶ä¸æ˜¯å¸Œæœ›é€è¿‡ VXLAN æ¥æä¾›æ–°çš„ feature , æ‰€ä»¥ flannel è¿™é‡Œåªæ˜¯æœ€ç®€å•çš„ä½¿ç”¨äº† VXLAN, æ¯”å¦‚ VNI é»˜è®¤ä¸º "),n("code",[a._v("1")]),a._v(", VTEP ä¸åˆ†ç»„, æ‰€æœ‰çš„ VTEP éƒ½æ˜¯ä¸€ä¸ªç»„, å¹¶ä¸” flannel ä¼šæ‰‹åŠ¨ç»´æŠ¤ VTEP çš„ FDB(mac to ip) è¡¨ å’Œ ARP (ip to mac)è¡¨.")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-02-arch-VXLAN.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3Dcede62736c78d4ed900aa38e06d8c3f68cc373a1",alt:"img"}})]),a._v(" "),n("p",[a._v("åœ¨å‰é¢çš„æµç¨‹éƒ½ç±»ä¼¼, ä» "),n("code",[a._v("Network Namespace")]),a._v(" å‡ºæ¥, ç»è¿‡ docker 0 / CNI 0 , ç„¶åæ¥åˆ° "),n("code",[a._v("Linux Kernel FIB")]),a._v(", åŒ¹é…åˆ°è·¯ç”±è§„åˆ™, å°†æ•°æ®åŒ…ä¸¢ç»™ flannel.1 , åœ¨è¿™é‡Œ é€è¿‡ flanneld ä»¥åŠ flanneld ç»´æŠ¤çš„ FDB ä»¥åŠ ARP è¡¨, æŒ‰ç…§ VXLAN çš„æ–¹å¼åŒ…è£…å, å°†æ•°æ®åŒ…ä¸¢ç»™ Node B, æ¥ç€ Node B é‡Œçš„ VTEP è¿›è¡Œè§£åŒ…, ç„¶åå°†æ•°æ®é€è¿‡ Linux Kernel Router ä¸­çš„è·¯ç”±ç»™åˆ° docker0 / cni0 bridge , æ¥ç€å†é€šè¿‡ veth pair ç»™åˆ° å®é™…çš„åº”ç”¨ç¨‹åº.")]),a._v(" "),n("h4",{attrs:{id:"ç»“-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç»“-2"}},[a._v("#")]),a._v(" ç»“")]),a._v(" "),n("p",[a._v("çœ‹èµ·æ¥è¿™é‡Œçš„è½¬å‘é“¾æ¡çŸ­äº†ä¸€äº›, å¹¶ä¸”è½¬å‘æ•ˆç‡æ¯” TUN æ–¹æ¡ˆå¥½ä¸€äº›,æ•´ä¸ªè¿‡ç¨‹å®Œå…¨åœ¨å†…æ ¸æ€å®Œæˆ, flanneld å¹¶ä¸ç›´æ¥å‚ä¸è½¬å‘è¿‡ç¨‹, åªæ˜¯è´Ÿè´£è¿›è¡Œé…ç½®.")]),a._v(" "),n("p",[a._v("ä½†æ˜¯ç”±äº VXLAN æœ¬èº«å°±æœ‰ä¸€å®šçš„å¤æ‚æ€§, è®©å®ƒçš„åŠ å…¥ä½¿å¾— flannel çš„å¤æ‚åº¦åˆç¨æœ‰ä¸Šå‡. flannel åœ¨ FDB å’Œ ARP è¡¨çš„ç»´æŠ¤é—®é¢˜ä¸Šæ”¹è¿›äº†ä¸¤æ¬¡æ–¹æ¡ˆ, èµ·åˆæ˜¯è®© VTEP è‡ªåŠ¨å­¦ä¹ , æœ€åå¹²è„†ç›´æ¥è®© flanneld è‡ªè¡Œæ‰‹åŠ¨ç»´æŠ¤.")]),a._v(" "),n("h3",{attrs:{id:"backend-host-gateway"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backend-host-gateway"}},[a._v("#")]),a._v(" backend Host-Gateway")]),a._v(" "),n("h4",{attrs:{id:"è®¾è®¡-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#è®¾è®¡-3"}},[a._v("#")]),a._v(" è®¾è®¡")]),a._v(" "),n("p",[a._v("å…¶å®æœ¬è´¨ä¸Š, ä¹Ÿå°±åªæ˜¯æƒ³æŠŠ æ•°æ®åŒ… è½¬å‘åˆ°å¯¹åº”çš„èŠ‚ç‚¹ä¸Š, ç„¶åè®©é‚£ä¸ªèŠ‚ç‚¹è‡ªè¡Œå°† æ•°æ®åŒ… æŠ•é€’åˆ°å¯¹åº”çš„å®¹å™¨ä¸­, é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½è®©å¯¹åº”çš„èŠ‚ç‚¹ä½œä¸ºç½‘å…³å‘¢?")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-03-arch-host-gateway.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3D991f6f996ddce54a1690f2f3c0ad94aaa50314f7",alt:"img"}})]),a._v(" "),n("p",[a._v("flannel å°±æ˜¯è¿™ä¹ˆåšçš„, flanneld ä¼šé…ç½® è·¯ç”±è§„åˆ™åœ¨ "),n("code",[a._v("Linux Kernel FIB")]),a._v(" ä¸Š, ä½†æ˜¯è¿™æ¬¡å®ƒä¼šæŠŠ Node B å¯¹åº”çš„è·¯ç”±ç½‘å…³è®¾ç½®ä¸º Node Bçš„ IP, å¹¶åˆ›å»ºå¦ä¸€ä¸ªç½‘å¡ eth1, å¹¶ä¸”åœ¨ eth 1 çš„ç½‘æ®µè®¾ç½®ä¸Š, æ•…æ„å’ŒåŸæœ‰çš„ eth0 é”™å¼€ç½‘æ®µ, å½“ Node A çš„ "),n("code",[a._v("Linux Kernel FIB")]),a._v(" æƒ³ç›´æ¥è½¬å‘æ•°æ®åŒ…ç»™ Node B çš„æ—¶å€™, å‘ç°è¿™æ˜¯å¦ä¸€ä¸ªç½‘æ®µçš„åŒ…, å®ƒå°šæœªçŸ¥é“ Node B çš„ Mac åœ°å€, æ‰€ä»¥ Node A ä¼šå°†æ•°æ®åŒ…ä¼ ç»™ å¯¹åº”çš„ ç½‘å…³, æ•°æ®åŒ…å°±ç›´æ¥ç»™åˆ° Node B, è¿™ä¸ªæ—¶å€™ Node B åªéœ€è¦å°†æ•°æ®åŒ…æŠ•é€’ç»™å¯¹åº”çš„å®¹å™¨å³å¯, å¯ä»¥çœ‹åˆ°æ–¹æ¡ˆçš„å˜å¾—ç®€å•äº†å¾ˆå¤š.")]),a._v(" "),n("p",[a._v("Node A çš„è·¯ç”±è¡¨å¤§è‡´é•¿è¿™æ ·å­")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("10.244.0.0        0.0.0.0                255.255.255.0 u 0 0 0 cni0\n10.244.1.0        172.16.139.150        255.255.255.0 u 0 0 0 eth1\n10.244.2.0        172.16.139.154        255.255.255.0 u 0 0 0 eth1\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("p",[a._v("åœ¨ host-gateway æ¨¡å¼å, flanneld çš„ä½œç”¨å°±åªæœ‰åˆ·æ–°æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ è·¯ç”±è¡¨äº†.")]),a._v(" "),n("h4",{attrs:{id:"ç»“-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç»“-3"}},[a._v("#")]),a._v(" ç»“")]),a._v(" "),n("p",[a._v("ç”±äº Host-Gateway ä¼šæŒ‡å®šå¯¹åº”çš„èŠ‚ç‚¹ IP ä½œä¸ºç½‘å…³, é‚£ä¹ˆå®ƒå°±è¦æ±‚æ‰€æœ‰çš„èŠ‚ç‚¹å¿…é¡»åœ¨ä¸€ä¸ªå­ç½‘èŒƒå›´å†…, ä¸ç„¶è„±ç¦»äº†å½“å‰çš„å­ç½‘, åˆ™éœ€è¦å¦è¡Œé…ç½®ä¸Šå±‚ç½‘ç»œçš„è·¯ç”±è§„åˆ™, ä½† flannel æ— æ³•æ§åˆ¶ä¸Šå±‚ç½‘ç»œ, è¿™å°†ä½¿ flannel å˜å¾—å¤æ‚, æ‰€ä»¥ Host-Gateway æ–¹æ¡ˆåªæ”¯æŒåœ¨åŒä¸€ä¸ªå­ç½‘å†…, ä¸è¿‡è¿™ä¸ªæ¡ä»¶åœ¨ K8s ä¸Š, é›†ç¾¤è§„æ¨¡ä¸å¤§çš„è¯, è¿˜æ˜¯å¾ˆå®¹æ˜“è¾¾æˆçš„.")]),a._v(" "),n("h3",{attrs:{id:"runtime-æ–¹æ¡ˆè®¾è®¡-ç»“"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#runtime-æ–¹æ¡ˆè®¾è®¡-ç»“"}},[a._v("#")]),a._v(" runtime æ–¹æ¡ˆè®¾è®¡ [ç»“]")]),a._v(" "),n("p",[a._v("ä»ç¬”è€…çš„è§’åº¦åœ¨æ€»ç»“çš„è¯, TUN æ–¹æ¡ˆç¬”è€…è®¤ä¸ºæ›´åƒä¸€ä¸ªå®Œæˆéœ€æ±‚çš„ MVP(æœ€å°å¯è¡Œæ€§æ¨¡å‹), è™½ç„¶èƒ½å¤Ÿå®Œæˆéœ€æ±‚, ä½†æ˜¯æœ‰ä¸€å®šçš„ç¼ºé™·, æˆ‘è§‰å¾— CoreOS çš„å·¥ç¨‹å¸ˆä¸€å®šçŸ¥é“åœ¨ç”¨æˆ·æ€ä¸‹å¤„ç†ç½‘ç»œåŒ…ä¼šå‡ºç°æ€§èƒ½é—®é¢˜, å³ä¾¿å¦‚æ­¤, ä»–ä»¬è¿˜æ˜¯è¿™ä¹ˆåšäº†, flannel æ˜¯ä¸€ä¸ªå¾ˆæ—©å°±å‡ºç°çš„ K8s ç½‘ç»œæ–¹æ¡ˆ, å¯ä»¥çœ‹å‡ºä»–ä»¬çš„æ¢ç´¢æ¨¡å¼è¿˜æ˜¯æŒºå€¼å¾—å­¦ä¹ çš„.")]),a._v(" "),n("p",[a._v("æ¥ç€å†å¯¹è¿™ä¸ª MVP ä¼˜åŒ–, å€ŸåŠ© VXLAN çš„åŠ›é‡, å°†æ•´ä¸ªä¸šåŠ¡æµç¨‹å®Œå…¨æ‹‰åˆ°å†…æ ¸æ€ä¸‹, å°±é¿å…äº†ç”¨æˆ·æ€å’Œ å†…æ ¸æ€åˆ‡æ¢çš„æ€§èƒ½è€—æŸ, ä½†ä¹Ÿæ— å¯é¿å…éœ€è¦æ¶ˆåŒ– VXLAN çš„å¤æ‚æ€§. ä½ å¯ä»¥çœ‹åˆ° flannel åªä½¿ç”¨äº† VXLAN å¾ˆå°çš„ä¸€éƒ¨åˆ†åŠŸèƒ½, VNI ç›´æ¥æ°¸è¿œè®¾ä¸º 1 , FDB å’Œ ARP éƒ½æ˜¯æ‰‹åŠ¨ç»´æŠ¤çš„.")]),a._v(" "),n("p",[a._v("éšå, å¯èƒ½æ˜¯æœ‰äº†çµæ„Ÿ, ç›´æ¥å°† å¯¹åº”çš„èŠ‚ç‚¹ä½œä¸º ç½‘å…³, è¿™æ ·å°±è§£å†³äº†è½¬å‘çš„å¤æ‚æ€§, å¹¶ä¸”ç”±äºæ˜¯ç›´æ¥è·¯ç”±è½¬å‘çš„æ–¹æ¡ˆ, æ€§èƒ½ä¹Ÿæ˜¯æœ‰ä¿è¯çš„.")]),a._v(" "),n("p",[a._v("å†éšå, flannel è¿˜åšäº† ä¾‹å¦‚ "),n("code",[a._v("ipipè½¬å‘")]),a._v("(host-gw çš„å†æ”¹è¿›ç‰ˆ), "),n("code",[a._v("ipsec")]),a._v(" ç­‰çš„æ–¹æ¡ˆ, è¿™äº›æ–¹æ¡ˆçš„æ€è·¯å’Œä¸Šè¿°æ–¹æ¡ˆçš„æ€è·¯ç±»ä¼¼, è¿™é‡Œå°±ä¸èµ˜è¿°.")]),a._v(" "),n("h2",{attrs:{id:"ä¸-k8s-ç»“åˆ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸-k8s-ç»“åˆ"}},[a._v("#")]),a._v(" ä¸ K8s ç»“åˆ")]),a._v(" "),n("p",[a._v("å¤§å¤šæ•°çš„æ–‡ç« å†™åˆ°è¿™é‡Œå°±åœäº†, ä½†å…¶å®åªä»‹ç» flannel çš„ runtime æ˜¯æ²¡æœ‰åŠæ³•å’Œ K8s ç›¸å…³çŸ¥è¯†ä¸²èµ·æ¥çš„, è¿˜éœ€è¦äº†è§£ flannel æ˜¯å¦‚ä½• æ”¯æŒ CNI æ¥è¾¾æˆå’Œ K8s åä½œçš„.")]),a._v(" "),n("p",[a._v("é¦–å…ˆ, flannel æœ¬èº«å’Œ CNI æ˜¯æ— å…³çš„, flannel ä¼šæœ‰ ä¸€ä¸ª cni-plugins ä¸“é—¨ä¸ cni äº¤äº’. æˆ‘ä»¬é€è¿‡ K8s æ‹‰å–çš„ flannel é•œåƒ, é¦–å…ˆä¼šæœ‰ä¸€ä¸ª Init Container å°†CNI çš„ é…ç½®ä¿¡æ¯ copy åˆ°æœ¬æœºçš„å¯¹åº”çš„ä½ç½®. ä¼šè¿è¡Œ flanneld, ç„¶ååœ¨ /etc/flannel/subnet.env ä¸­å†™å…¥å½“å‰æœºå™¨åˆ†é…åˆ°çš„å­ç½‘ä¿¡æ¯, æ¥ç€ flanneld æ ¹æ®æ‰€è®¾ç½®çš„ flannel æ¨¡å¼, ä¼šè¿›è¡Œè‡ªå·±çš„å·¥ä½œ.")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-05-arch-CNI-Timing-deploying.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3D2899bbd53072cea0bbb408daa86e5974e1ef84d9",alt:"img"}})]),a._v(" "),n("p",[a._v("æ¥ç€, åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™, CRI çš„å®ç°, ä¾‹å¦‚ containerd , ä¼šè°ƒç”¨ CNI çš„æ¥å£, è¦æ±‚ CNI å»ç”Ÿæˆä¸€ä»½ å®¹å™¨çš„ç½‘ç»œä¿¡æ¯, è¿™æ—¶ CNI è¯»å–æœ¬æœºçš„ CNI é…ç½®, å»é€šè¿‡ Shell å‘½ä»¤æ‰§è¡Œ CNI ä¸­å†™çš„ CNI plugins, è¿™ä¸ªæ—¶å€™ä¼šå¯åŠ¨ flannel çš„ cni plugins, è¿™ä¸ªç¨‹åºä¼šæ ¹æ®è¯»å– flannel å†™åœ¨ "),n("code",[a._v("/etc/flannel/subnet.env")]),a._v(" çš„å­ç½‘ä¿¡æ¯, ç„¶åè¯»å– CNI çš„é…ç½®ä¿¡æ¯, æ¥ç€è¿˜æ˜¯è°ƒç”¨ CNI çš„åº“, å°†è¿™äº›é…ç½®ä¿¡æ¯ä¼ ç»™ CNI æ–¹æ³•, æ¥ç€ CNI çš„æ–¹æ³•ä¼šè°ƒç”¨é…ç½®çš„å·¥å…·è¿›è¡Œ "),n("code",[a._v("bridge")]),a._v(", "),n("code",[a._v("veth pair")]),a._v(" ç­‰ç½‘ç»œè®¾å¤‡çš„åˆ›å»º, ç„¶åè°ƒç”¨æ³¨å†Œçš„ IPAM ç¨‹åºåˆ†é… IP åœ°å€ (é»˜è®¤æ˜¯ "),n("code",[a._v("host-local")]),a._v(" ), åœ¨ä¸€åˆ‡å°±ç»ªå, ä¼šå°† IPåœ°å€ç­‰ä¿¡æ¯é€šè¿‡æ ‡å‡†è¾“å‡ºç»™å› CRI ä¸­è°ƒç”¨çš„ CNI çš„æ–¹æ³•, ç„¶å CNI çš„ function åºåˆ—åŒ–æ•°æ®å, å°†æ•°æ®è¿”å›ç»™ CRI æ’ä»¶. æ—¶åºå›¾å¦‚ä¸‹:")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://kurisu-cc-1253443349.cos.ap-guangzhou.myqcloud.com/assets/flannel-06-arch-CNI-Timing-running.png?sign=q-sign-algorithm%3Dsha1%26q-ak%3DAKIDmcLEhLf8xmVsMkrEVfIoEUaYQFxUr25y%26q-sign-time%3D1631850998%3B1637035058%26q-key-time%3D1631850998%3B1637035058%26q-header-list%3Dhost%26q-url-param-list%3D%26q-signature%3D1c21960ef2afd8946fc1fedaaf46375330207034",alt:"img"}})]),a._v(" "),n("p",[a._v("ä½ å¯ä»¥çœ‹åˆ° flannel å¹¶ä¸æ˜¯å¼ºç»‘å®š K8s çš„, flannel åªæ˜¯ä¾èµ– etcd . å¤§å¤šæ•°çš„ K8s çš„ç½‘ç»œæ–¹æ¡ˆè‡ªèº«ä¹Ÿæ”¯æŒ ä¸ºè™šæ‹Ÿæœºæä¾›æœåŠ¡.")]),a._v(" "),n("h2",{attrs:{id:"ref"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ref"}},[a._v("#")]),a._v(" ref")]),a._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.hwchiu.com/cni-flannel-ii.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("CNI - Flannel - IP ç®¡ç†ç¯‡ - hwchiu"),n("OutboundLink")],1)]),a._v(" "),n("li",[n("a",{attrs:{href:"https://jimmysong.io/kubernetes-handbook/concepts/cni.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("CNI -jimmysong"),n("OutboundLink")],1)])]),a._v(" "),n("p",[a._v("If you need to discuss, you can go to "),n("a",{attrs:{href:"https://github.com/Kuri-su/KBlog",target:"_blank",rel:"noopener noreferrer"}},[a._v("Kuri-su/KBlog"),n("OutboundLink")],1),a._v(" to make an issue.")]),a._v(" "),n("p",[a._v("This article is licensed under a "),n("a",{attrs:{href:"https://creativecommons.org/licenses/by-nc-nd/4.0/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0) License"),n("OutboundLink")],1),a._v(".")]),a._v(" "),n("p",[a._v("Powered By Amatist_Kurisu and Jcc/Blog â¤  |  Designed By Amatist_Kurisu â¤  |  Cover Image From äº•æ³¢ãƒãƒˆã‚³ â¤")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://kuricat.com/link",target:"_blank",rel:"noopener noreferrer"}},[a._v("LINKS"),n("OutboundLink")],1)]),a._v(" "),n("p",[n("a",{attrs:{href:"https://kuricat.com/rss",target:"_blank",rel:"noopener noreferrer"}},[a._v("RSS"),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("Â© Amatist_Kurisu 2018-2020. All rights reserved.")]),a._v(" "),n("iframe",{staticStyle:{"box-sizing":"border-box","max-width":"100%",margin:"0px !important",width:"30px",height:"150px","min-height":"0px",border:"0px",display:"block !important"},attrs:{name:"rpJSFrame",allowtransparency:"true"}})])}),[],!1,null,null,null);e.default=t.exports}}]);