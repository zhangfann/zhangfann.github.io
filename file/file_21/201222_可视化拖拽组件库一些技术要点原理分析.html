<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>可视化拖拽组件库一些技术要点原理分析 | 小张笔记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-141019448-1"></script>
    <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
      
          gtag('config', 'UA-141019448-1');
      </script>
    <script async="true" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2468672938537807" crossorigin="anonymous"></script>
    <meta name="description" content="Little Zhang's Note">
    <meta name="baidu-site-verification" content="code-HRrK6kdBX1">
    
    <link rel="preload" href="/assets/css/0.styles.9b71556a.css" as="style"><link rel="preload" href="/assets/js/app.59705b41.js" as="script"><link rel="preload" href="/assets/js/2.a6173bc2.js" as="script"><link rel="preload" href="/assets/js/23.f6407bd5.js" as="script"><link rel="prefetch" href="/assets/js/10.bf63d664.js"><link rel="prefetch" href="/assets/js/100.03316f1c.js"><link rel="prefetch" href="/assets/js/101.1752c00a.js"><link rel="prefetch" href="/assets/js/102.07d89fbc.js"><link rel="prefetch" href="/assets/js/103.993c777d.js"><link rel="prefetch" href="/assets/js/104.751e72ae.js"><link rel="prefetch" href="/assets/js/105.a9f677f4.js"><link rel="prefetch" href="/assets/js/106.b5844b20.js"><link rel="prefetch" href="/assets/js/107.1a39af47.js"><link rel="prefetch" href="/assets/js/108.afc6efa7.js"><link rel="prefetch" href="/assets/js/109.95afd03d.js"><link rel="prefetch" href="/assets/js/11.48fa6147.js"><link rel="prefetch" href="/assets/js/110.94fc9104.js"><link rel="prefetch" href="/assets/js/111.e2d59692.js"><link rel="prefetch" href="/assets/js/112.8bd3854d.js"><link rel="prefetch" href="/assets/js/113.11a364cf.js"><link rel="prefetch" href="/assets/js/114.b72b6211.js"><link rel="prefetch" href="/assets/js/115.69636b31.js"><link rel="prefetch" href="/assets/js/116.40f54ce7.js"><link rel="prefetch" href="/assets/js/117.7a9c97bf.js"><link rel="prefetch" href="/assets/js/118.35370456.js"><link rel="prefetch" href="/assets/js/119.803001ba.js"><link rel="prefetch" href="/assets/js/12.ef0e7bb2.js"><link rel="prefetch" href="/assets/js/120.41ae5ce2.js"><link rel="prefetch" href="/assets/js/121.574c1406.js"><link rel="prefetch" href="/assets/js/122.d7aa4bde.js"><link rel="prefetch" href="/assets/js/123.e45f6aa6.js"><link rel="prefetch" href="/assets/js/124.439f290f.js"><link rel="prefetch" href="/assets/js/125.0ba4fef5.js"><link rel="prefetch" href="/assets/js/126.167213e1.js"><link rel="prefetch" href="/assets/js/127.bfa9f828.js"><link rel="prefetch" href="/assets/js/128.f76b6b12.js"><link rel="prefetch" href="/assets/js/129.845e984c.js"><link rel="prefetch" href="/assets/js/13.60c4e03a.js"><link rel="prefetch" href="/assets/js/130.c019f492.js"><link rel="prefetch" href="/assets/js/131.801cfd17.js"><link rel="prefetch" href="/assets/js/132.320ffcae.js"><link rel="prefetch" href="/assets/js/133.8c638fc4.js"><link rel="prefetch" href="/assets/js/134.a6998c7d.js"><link rel="prefetch" href="/assets/js/135.a1ae7010.js"><link rel="prefetch" href="/assets/js/136.740fe250.js"><link rel="prefetch" href="/assets/js/137.9539721b.js"><link rel="prefetch" href="/assets/js/138.074a22c7.js"><link rel="prefetch" href="/assets/js/139.cf86b3b2.js"><link rel="prefetch" href="/assets/js/14.a7d3976d.js"><link rel="prefetch" href="/assets/js/140.343cf95d.js"><link rel="prefetch" href="/assets/js/141.d2a630a0.js"><link rel="prefetch" href="/assets/js/142.f0396341.js"><link rel="prefetch" href="/assets/js/143.fad4d70a.js"><link rel="prefetch" href="/assets/js/144.0b61a03b.js"><link rel="prefetch" href="/assets/js/145.b026234b.js"><link rel="prefetch" href="/assets/js/146.35587f65.js"><link rel="prefetch" href="/assets/js/147.119cfa30.js"><link rel="prefetch" href="/assets/js/148.21d10c5d.js"><link rel="prefetch" href="/assets/js/149.358de87e.js"><link rel="prefetch" href="/assets/js/15.ea316444.js"><link rel="prefetch" href="/assets/js/150.1eccb0ef.js"><link rel="prefetch" href="/assets/js/151.99eb067e.js"><link rel="prefetch" href="/assets/js/152.4a8071a1.js"><link rel="prefetch" href="/assets/js/153.37e8e5f4.js"><link rel="prefetch" href="/assets/js/154.229e9bef.js"><link rel="prefetch" href="/assets/js/155.d7e35a2e.js"><link rel="prefetch" href="/assets/js/156.cd50c462.js"><link rel="prefetch" href="/assets/js/157.d5173787.js"><link rel="prefetch" href="/assets/js/158.6475cc5a.js"><link rel="prefetch" href="/assets/js/159.c7bb84e1.js"><link rel="prefetch" href="/assets/js/16.b93d6c0b.js"><link rel="prefetch" href="/assets/js/160.831f4447.js"><link rel="prefetch" href="/assets/js/161.4c312f6f.js"><link rel="prefetch" href="/assets/js/162.1fe949f9.js"><link rel="prefetch" href="/assets/js/163.dd6193aa.js"><link rel="prefetch" href="/assets/js/164.bd8fcbc1.js"><link rel="prefetch" href="/assets/js/165.0e630561.js"><link rel="prefetch" href="/assets/js/166.3ee43b85.js"><link rel="prefetch" href="/assets/js/167.9a78500a.js"><link rel="prefetch" href="/assets/js/168.3413f0f7.js"><link rel="prefetch" href="/assets/js/169.266b09af.js"><link rel="prefetch" href="/assets/js/17.0c814d3e.js"><link rel="prefetch" href="/assets/js/170.dee11218.js"><link rel="prefetch" href="/assets/js/171.bbae1fb6.js"><link rel="prefetch" href="/assets/js/172.f21fb4ea.js"><link rel="prefetch" href="/assets/js/173.f762d29c.js"><link rel="prefetch" href="/assets/js/18.842701cb.js"><link rel="prefetch" href="/assets/js/19.ae3578e4.js"><link rel="prefetch" href="/assets/js/20.870d9de1.js"><link rel="prefetch" href="/assets/js/21.abf3d0d4.js"><link rel="prefetch" href="/assets/js/22.89c8dd55.js"><link rel="prefetch" href="/assets/js/24.f2993d9f.js"><link rel="prefetch" href="/assets/js/25.fd7244ce.js"><link rel="prefetch" href="/assets/js/26.d5a8efd0.js"><link rel="prefetch" href="/assets/js/27.be3c7096.js"><link rel="prefetch" href="/assets/js/28.065e60f5.js"><link rel="prefetch" href="/assets/js/29.9e855a1b.js"><link rel="prefetch" href="/assets/js/3.582414ce.js"><link rel="prefetch" href="/assets/js/30.d92d4132.js"><link rel="prefetch" href="/assets/js/31.014d4757.js"><link rel="prefetch" href="/assets/js/32.2dfe25f3.js"><link rel="prefetch" href="/assets/js/33.7108bfa8.js"><link rel="prefetch" href="/assets/js/34.c8d3757e.js"><link rel="prefetch" href="/assets/js/35.6d5c738c.js"><link rel="prefetch" href="/assets/js/36.dc89a8b9.js"><link rel="prefetch" href="/assets/js/37.300b4c9e.js"><link rel="prefetch" href="/assets/js/38.71bb421f.js"><link rel="prefetch" href="/assets/js/39.266b67d8.js"><link rel="prefetch" href="/assets/js/4.ef205920.js"><link rel="prefetch" href="/assets/js/40.4a34c99b.js"><link rel="prefetch" href="/assets/js/41.a24e4cfe.js"><link rel="prefetch" href="/assets/js/42.26dae2e8.js"><link rel="prefetch" href="/assets/js/43.66b41ada.js"><link rel="prefetch" href="/assets/js/44.500d4a1c.js"><link rel="prefetch" href="/assets/js/45.90c7216d.js"><link rel="prefetch" href="/assets/js/46.1571750c.js"><link rel="prefetch" href="/assets/js/47.fb7798e4.js"><link rel="prefetch" href="/assets/js/48.a8d36995.js"><link rel="prefetch" href="/assets/js/49.d7bd9e1a.js"><link rel="prefetch" href="/assets/js/5.6c7f4d05.js"><link rel="prefetch" href="/assets/js/50.942ee843.js"><link rel="prefetch" href="/assets/js/51.43bc5a7a.js"><link rel="prefetch" href="/assets/js/52.ad702f3d.js"><link rel="prefetch" href="/assets/js/53.b694c7ea.js"><link rel="prefetch" href="/assets/js/54.f9722d7d.js"><link rel="prefetch" href="/assets/js/55.ff1be627.js"><link rel="prefetch" href="/assets/js/56.931560b0.js"><link rel="prefetch" href="/assets/js/57.a80c4ce6.js"><link rel="prefetch" href="/assets/js/58.88c795ee.js"><link rel="prefetch" href="/assets/js/59.d295c4de.js"><link rel="prefetch" href="/assets/js/6.bb33fed3.js"><link rel="prefetch" href="/assets/js/60.94c5cde6.js"><link rel="prefetch" href="/assets/js/61.59c5ee89.js"><link rel="prefetch" href="/assets/js/62.77ac5f18.js"><link rel="prefetch" href="/assets/js/63.81429f13.js"><link rel="prefetch" href="/assets/js/64.8979fd95.js"><link rel="prefetch" href="/assets/js/65.a79f97bc.js"><link rel="prefetch" href="/assets/js/66.171f35fe.js"><link rel="prefetch" href="/assets/js/67.6ccaeff8.js"><link rel="prefetch" href="/assets/js/68.8d3b5748.js"><link rel="prefetch" href="/assets/js/69.f516b6b4.js"><link rel="prefetch" href="/assets/js/7.03daa1b7.js"><link rel="prefetch" href="/assets/js/70.391277d9.js"><link rel="prefetch" href="/assets/js/71.aae34cc7.js"><link rel="prefetch" href="/assets/js/72.2633590e.js"><link rel="prefetch" href="/assets/js/73.0a792cef.js"><link rel="prefetch" href="/assets/js/74.f3d9a3cd.js"><link rel="prefetch" href="/assets/js/75.5afb9d35.js"><link rel="prefetch" href="/assets/js/76.d7aa9b4d.js"><link rel="prefetch" href="/assets/js/77.aaba26af.js"><link rel="prefetch" href="/assets/js/78.13eecef6.js"><link rel="prefetch" href="/assets/js/79.a10866fe.js"><link rel="prefetch" href="/assets/js/8.150af887.js"><link rel="prefetch" href="/assets/js/80.f17ed883.js"><link rel="prefetch" href="/assets/js/81.933fc2db.js"><link rel="prefetch" href="/assets/js/82.5ea7b2c6.js"><link rel="prefetch" href="/assets/js/83.d550c574.js"><link rel="prefetch" href="/assets/js/84.ab04e8f1.js"><link rel="prefetch" href="/assets/js/85.1a91710d.js"><link rel="prefetch" href="/assets/js/86.adc15b31.js"><link rel="prefetch" href="/assets/js/87.2deb96d6.js"><link rel="prefetch" href="/assets/js/88.374de15d.js"><link rel="prefetch" href="/assets/js/89.2edab492.js"><link rel="prefetch" href="/assets/js/9.f7aab732.js"><link rel="prefetch" href="/assets/js/90.05985ef4.js"><link rel="prefetch" href="/assets/js/91.486e70d6.js"><link rel="prefetch" href="/assets/js/92.44b6b56c.js"><link rel="prefetch" href="/assets/js/93.50ec585e.js"><link rel="prefetch" href="/assets/js/94.40b89e32.js"><link rel="prefetch" href="/assets/js/95.8aeee9b2.js"><link rel="prefetch" href="/assets/js/96.ef8bcb5f.js"><link rel="prefetch" href="/assets/js/97.a243eda2.js"><link rel="prefetch" href="/assets/js/98.46127310.js"><link rel="prefetch" href="/assets/js/99.ac24a1be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b71556a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小张笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://toutiao.zhangfan.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小张头条
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/file/file_21/201222_可视化拖拽组件库一些技术要点原理分析.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://toutiao.zhangfan.vip" target="_blank" rel="noopener noreferrer" class="nav-link external">
  小张头条
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/file/file_21/201222_可视化拖拽组件库一些技术要点原理分析.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>可视化拖拽组件库一些技术要点原理分析</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>掘金是一个帮助开发者成长的社区，是给开发者用的 Hacker News，给设计师用的 Designer News，和给产品经理用的 Medium。
本文主要对以下技术要点进行分析：</p> <p>编辑器
自定义组件
拖拽
删除组件、调整图层层级
放大缩小
撤消、重做
组件属性设置
吸附
预览、保存代码
绑定事件
绑定动画
导入 PSD
手机模式
为了让本文更加容易理解，我将以上技术要点结合在一起写了一个可视化拖拽组件库 DEMO：</p> <p>github 项目地址
在线预览
建议结合源码一起阅读，效果更好（这个 DEMO 使用的是 Vue 技术栈）。</p> <ol><li>编辑器
先来看一下页面的整体结构。</li></ol> <p>这一节要讲的编辑器其实就是中间的画布。它的作用是：当从左边组件列表拖拽出一个组件放到画布中时，画布要把这个组件渲染出来。</p> <p>这个编辑器的实现思路是：</p> <p>用一个数组 componentData 维护编辑器中的数据。
把组件拖拽到画布中时，使用 push() 方法将新的组件数据添加到 componentData。
编辑器使用 v-for 指令遍历 componentData，将每个组件逐个渲染到画布（也可以使用 JSX 语法结合 render() 方法代替）。
编辑器渲染的核心代码如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;component 
  v-for=&quot;item in componentData&quot;
  :key=&quot;item.id&quot;
  :is=&quot;item.component&quot;
  :style=&quot;item.style&quot;
  :propValue=&quot;item.propValue&quot;
/&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>复制代码
每个组件数据大概是这样：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    component: 'v-text', 
    label: '文字', 
    propValue: '文字', 
    icon: 'el-icon-edit', 
    animations: [], 
    events: {}, 
    style: { 
        width: 200,
        height: 33,
        fontSize: 14,
        fontWeight: 500,
        lineHeight: '',
        letterSpacing: 0,
        textAlign: '',
        color: '',
    },
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>复制代码
在遍历 componentData 组件数据时，主要靠 is 属性来识别出真正要渲染的是哪个组件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>例如要渲染的组件数据是 { component: 'v-text' }，则 &lt;component :is=&quot;item.component&quot; /&gt; 会被转换为 &lt;v-text /&gt;。当然，你这个组件也要提前注册到 Vue 中。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果你想了解更多 is 属性的资料，请查看官方文档。</p> <ol start="2"><li>自定义组件
原则上使用第三方组件也是可以的，但建议你最好封装一下。不管是第三方组件还是自定义组件，每个组件所需的属性可能都不一样，所以每个组件数据可以暴露出一个属性 propValue 用于传递值。</li></ol> <p>例如 a 组件只需要一个属性，你的 propValue 可以这样写：propValue: 'aaa'。如果需要多个属性，propValue 则可以是一个对象：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>propValue: {
  a: 1,
  b: 'text'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>复制代码
在这个 DEMO 组件库中我定义了三个组件。</p> <p>图片组件 Picture：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;template&gt;
    &lt;div&gt;
        &lt;img :src=&quot;propValue&quot;&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    props: {
        propValue: {
            type: String,
            require: true,
        },
    },
}
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>复制代码
按钮组件 VButton:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;template&gt;
    &lt;button&gt;{{ propValue }}&lt;/button&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    props: {
        propValue: {
            type: String,
            default: '',
        },
    },
}
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>复制代码
文本组件 VText:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;template&gt;
    &lt;textarea 
        v-if=&quot;editMode == 'edit'&quot;
        :value=&quot;propValue&quot;
       
        @input=&quot;handleInput&quot;
        ref=&quot;v-text&quot;
    &gt;&lt;/textarea&gt;
    &lt;div v-else&gt;
        &lt;div v-for=&quot;(text, index) in propValue.split('\n')&quot; :key=&quot;index&quot;&gt;{{ text }}&lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { mapState } from 'vuex'

export default {
    props: {
        propValue: {
            type: String,
        },
        element: {
            type: Object,
        },
    },
    computed: mapState([
        'editMode',
    ]),
    methods: {
        handleInput(e) {
            this.$emit('input', this.element, e.target.value)
        },
    },
}
&lt;/script&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>复制代码
3. 拖拽
从组件列表到画布
一个元素如果要设为可拖拽，必须给它添加一个 draggable 属性。另外，在将组件列表中的组件拖拽到画布中，还有两个事件是起到关键作用的：</p> <p>dragstart 事件，在拖拽刚开始时触发。它主要用于将拖拽的组件信息传递给画布。
drop 事件，在拖拽结束时触发。主要用于接收拖拽的组件信息。
先来看一下左侧组件列表的代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;div @dragstart=&quot;handleDragStart&quot;&gt;
    &lt;div v-for=&quot;(item, index) in componentList&quot; :key=&quot;index&quot; draggable :data-index=&quot;index&quot;&gt;
        &lt;i :class=&quot;item.icon&quot;&gt;&lt;/i&gt;
        &lt;span&gt;{{ item.label }}&lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;
复制代码
handleDragStart(e) {
    e.dataTransfer.setData('index', e.target.dataset.index)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>复制代码
可以看到给列表中的每一个组件都设置了 draggable 属性。另外，在触发 dragstart 事件时，使用 dataTransfer.setData() 传输数据。再来看一下接收数据的代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;div @drop=&quot;handleDrop&quot; @dragover=&quot;handleDragOver&quot; @click=&quot;deselectCurComponent&quot;&gt;
    &lt;Editor /&gt;
&lt;/div&gt;
复制代码
handleDrop(e) {
    e.preventDefault()
    e.stopPropagation()
    const component = deepCopy(componentList[e.dataTransfer.getData('index')])
    this.$store.commit('addComponent', component)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>复制代码
触发 drop 事件时，使用 dataTransfer.getData() 接收传输过来的索引数据，然后根据索引找到对应的组件数据，再添加到画布，从而渲染组件。</p> <p>组件在画布中移动
首先需要将画布设为相对定位 position: relative，然后将每个组件设为绝对定位 position: absolute。除了这一点外，还要通过监听三个事件来进行移动：</p> <p>mousedown 事件，在组件上按下鼠标时，记录组件当前的位置，即 xy 坐标（为了方便讲解，这里使用的坐标轴，实际上 xy 对应的是 css 中的 left 和 top。
mousemove 事件，每次鼠标移动时，都用当前最新的 xy 坐标减去最开始的 xy 坐标，从而计算出移动距离，再改变组件位置。
mouseup 事件，鼠标抬起时结束移动。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>handleMouseDown(e) {
    e.stopPropagation()
    this.$store.commit('setCurComponent', { component: this.element, zIndex: this.zIndex })

    const pos = { ...this.defaultStyle }
    const startY = e.clientY
    const startX = e.clientX
    
    const startTop = Number(pos.top)
    const startLeft = Number(pos.left)

    const move = (moveEvent) =&gt; {
        const currX = moveEvent.clientX
        const currY = moveEvent.clientY
        pos.top = currY - startY + startTop
        pos.left = currX - startX + startLeft
        
        this.$store.commit('setShapeStyle', pos)
    }

    const up = () =&gt; {
        document.removeEventListener('mousemove', move)
        document.removeEventListener('mouseup', up)
    }

    document.addEventListener('mousemove', move)
    document.addEventListener('mouseup', up)
}
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol start="4"><li>删除组件、调整图层层级
改变图层层级
由于拖拽组件到画布中是有先后顺序的，所以可以按照数据顺序来分配图层层级。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>例如画布新增了五个组件 abcde，那它们在画布数据中的顺序为 [a, b, c, d, e]，图层层级和索引一一对应，即它们的 z-index 属性值是 01234（后来居上）。用代码表示如下：

&lt;div v-for=&quot;(item, index) in componentData&quot; :zIndex=&quot;index&quot;&gt;&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>复制代码
如果不了解 z-index 属性的，请看一下 MDN 文档。</p> <p>理解了这一点之后，改变图层层级就很容易做到了。改变图层层级，即是改变组件数据在 componentData 数组中的顺序。例如有 [a, b, c] 三个组件，它们的图层层级从低到高顺序为 abc（索引越大，层级越高）。</p> <p>如果要将 b 组件上移，只需将它和 c 调换顺序即可：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const temp = componentData[1]
componentData[1] = componentData[2]
componentData[2] = temp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>复制代码
同理，置顶置底也是一样，例如我要将 a 组件置顶，只需将 a 和最后一个组件调换顺序即可：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const temp = componentData[0]
componentData[0] = componentData[componentData.lenght - 1]
componentData[componentData.lenght - 1] = temp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>复制代码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>删除组件
删除组件非常简单，一行代码搞定：componentData.splice(index, 1)。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="5"><li>放大缩小
细心的网友可能会发现，点击画布上的组件时，组件上会出现 8 个小圆点。这 8 个小圆点就是用来放大缩小用的。实现原理如下：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 在每个组件外面包一层 Shape 组件，Shape 组件里包含 8 个小圆点和一个 &lt;slot&gt; 插槽，用于放置组件。
&lt;Shape v-for=&quot;(item, index) in componentData&quot;
    :defaultStyle=&quot;item.style&quot;
    :style=&quot;getShapeStyle(item.style, index)&quot;
    :key=&quot;item.id&quot;
    :active=&quot;item === curComponent&quot;
    :element=&quot;item&quot;
    :zIndex=&quot;index&quot;
&gt;
    &lt;component
       
        :is=&quot;item.component&quot;
        :style=&quot;getComponentStyle(item.style)&quot;
        :propValue=&quot;item.propValue&quot;
    /&gt;
&lt;/Shape&gt;
复制代码
Shape 组件内部结构：

&lt;template&gt;
    &lt;div :class=&quot;{ active: this.active }&quot; @click=&quot;selectCurComponent&quot; @mousedown=&quot;handleMouseDown&quot;
    @contextmenu=&quot;handleContextMenu&quot;&gt;
        &lt;div
           
            v-for=&quot;(item, index) in (active? pointList : [])&quot;
            @mousedown=&quot;handleMouseDownOnPoint(item)&quot;
            :key=&quot;index&quot;
            :style=&quot;getPointStyle(item)&quot;&gt;
        &lt;/div&gt;
        &lt;slot&gt;&lt;/slot&gt;
    &lt;/div&gt;
&lt;/template&gt;
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ol start="2"><li><p>点击组件时，将 8 个小圆点显示出来。
起作用的是这行代码 :active=&quot;item === curComponent&quot;。</p></li> <li><p>计算每个小圆点的位置。
先来看一下计算小圆点位置的代码：</p></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>const pointList = ['t', 'r', 'b', 'l', 'lt', 'rt', 'lb', 'rb']

getPointStyle(point) {
    const { width, height } = this.defaultStyle
    const hasT = /t/.test(point)
    const hasB = /b/.test(point)
    const hasL = /l/.test(point)
    const hasR = /r/.test(point)
    let newLeft = 0
    let newTop = 0

    
    if (point.length === 2) {
        newLeft = hasL? 0 : width
        newTop = hasT? 0 : height
    } else {
        
        if (hasT || hasB) {
            newLeft = width / 2
            newTop = hasT? 0 : height
        }

        
        if (hasL || hasR) {
            newLeft = hasL? 0 : width
            newTop = Math.floor(height / 2)
        }
    }

    const style = {
        marginLeft: hasR? '-4px' : '-3px',
        marginTop: '-3px',
        left: `${newLeft}px`,
        top: `${newTop}px`,
        cursor: point.split('').reverse().map(m =&gt; this.directionKey[m]).join('') + '-resize',
    }

    return style
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>复制代码
计算小圆点的位置需要获取一些信息：</p> <p>组件的高度 height、宽度 width
注意，小圆点也是绝对定位的，相对于 Shape 组件。所以有四个小圆点的位置很好确定：</p> <p>左上角的小圆点，坐标 left: 0, top: 0
右上角的小圆点，坐标 left: width, top: 0
左下角的小圆点，坐标 left: 0, top: height
右下角的小圆点，坐标 left: width, top: height</p> <p>另外的四个小圆点需要通过计算间接算出来。例如左边中间的小圆点，计算公式为 left: 0, top: height / 2，其他小圆点同理。</p> <ol start="4"><li>点击小圆点时，可以进行放大缩小操作。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>handleMouseDownOnPoint(point) {
    const downEvent = window.event
    downEvent.stopPropagation()
    downEvent.preventDefault()

    const pos = { ...this.defaultStyle }
    const height = Number(pos.height)
    const width = Number(pos.width)
    const top = Number(pos.top)
    const left = Number(pos.left)
    const startX = downEvent.clientX
    const startY = downEvent.clientY

    
    let needSave = false
    const move = (moveEvent) =&gt; {
        needSave = true
        const currX = moveEvent.clientX
        const currY = moveEvent.clientY
        const disY = currY - startY
        const disX = currX - startX
        const hasT = /t/.test(point)
        const hasB = /b/.test(point)
        const hasL = /l/.test(point)
        const hasR = /r/.test(point)
        const newHeight = height + (hasT? -disY : hasB? disY : 0)
        const newWidth = width + (hasL? -disX : hasR? disX : 0)
        pos.height = newHeight &gt; 0? newHeight : 0
        pos.width = newWidth &gt; 0? newWidth : 0
        pos.left = left + (hasL? disX : 0)
        pos.top = top + (hasT? disY : 0)
        this.$store.commit('setShapeStyle', pos)
    }

    const up = () =&gt; {
        document.removeEventListener('mousemove', move)
        document.removeEventListener('mouseup', up)
        needSave &amp;&amp; this.$store.commit('recordSnapshot')
    }

    document.addEventListener('mousemove', move)
    document.addEventListener('mouseup', up)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>复制代码
它的原理是这样的：</p> <p>点击小圆点时，记录点击的坐标 xy。
假设我们现在向下拖动，那么 y 坐标就会增大。
用新的 y 坐标减去原来的 y 坐标，就可以知道在纵轴方向的移动距离是多少。
最后再将移动距离加上原来组件的高度，就可以得出新的组件高度。
如果是正数，说明是往下拉，组件的高度在增加。如果是负数，说明是往上拉，组件的高度在减少。</p> <ol start="6"><li>撤消、重做
撤销重做的实现原理其实挺简单的，先看一下代码：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>snapshotData: [], 
snapshotIndex: -1, 
        
undo(state) {
    if (state.snapshotIndex &gt;= 0) {
        state.snapshotIndex--
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

redo(state) {
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotIndex++
        store.commit('setComponentData', deepCopy(state.snapshotData[state.snapshotIndex]))
    }
},

setComponentData(state, componentData = []) {
    Vue.set(state, 'componentData', componentData)
},

recordSnapshot(state) {
    
    state.snapshotData[++state.snapshotIndex] = deepCopy(state.componentData)
    
    if (state.snapshotIndex &lt; state.snapshotData.length - 1) {
        state.snapshotData = state.snapshotData.slice(0, state.snapshotIndex + 1)
    }
},
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>复制代码
用一个数组来保存编辑器的快照数据。保存快照就是不停地执行 push() 操作，将当前的编辑器数据推入 snapshotData 数组，并增加快照索引 snapshotIndex。目前以下几个动作会触发保存快照操作：</p> <p>新增组件
删除组件
改变图层层级
拖动组件结束时
...</p> <p>撤销
假设现在 snapshotData 保存了 4 个快照。即 [a, b, c, d]，对应的快照索引为 3。如果这时进行了撤销操作，我们需要将快照索引减 1，然后将对应的快照数据赋值给画布。</p> <p>例如当前画布数据是 d，进行撤销后，索引 -1，现在画布的数据是 c。</p> <p>重做
明白了撤销，那重做就很好理解了，就是将快照索引加 1，然后将对应的快照数据赋值给画布。</p> <p>不过还有一点要注意，就是在撤销操作中进行了新的操作，要怎么办呢？有两种解决方案：</p> <p>新操作替换当前快照索引后面所有的数据。还是用刚才的数据 [a, b, c, d] 举例，假设现在进行了两次撤销操作，快照索引变为 1，对应的快照数据为 b，如果这时进行了新的操作，对应的快照数据为 e。那 e 会把 cd 顶掉，现在的快照数据为 [a, b, e]。
不顶掉数据，在原来的快照中新增一条记录。用刚才的例子举例，e 不会把 cd 顶掉，而是在 cd 之前插入，即快照数据变为 [a, b, e, c, d]。
我采用的是第一种方案。</p> <ol start="7"><li>吸附
什么是吸附？就是在拖拽组件时，如果它和另一个组件的距离比较接近，就会自动吸附在一起。</li></ol> <p>吸附的代码大概在 300 行左右，建议自己打开源码文件看（文件路径：src\components\Editor\MarkLine.vue）。这里不贴代码了，主要说说原理是怎么实现的。</p> <p>标线
在页面上创建 6 条线，分别是三横三竖。这 6 条线的作用是对齐，它们什么时候会出现呢？</p> <p>上下方向的两个组件左边、中间、右边对齐时会出现竖线
左右方向的两个组件上边、中间、下边对齐时会出现横线
具体的计算公式主要是根据每个组件的 xy 坐标和宽度高度进行计算的。例如要判断 ab 两个组件的左边是否对齐，则要知道它们每个组件的 x 坐标；如果要知道它们右边是否对齐，除了要知道 x 坐标，还要知道它们各自的宽度。</p> <p>a.x == b.x</p> <p>a.x + a.width == b.x + b.width
复制代码
在对齐的时候，显示标线。</p> <p>另外还要判断 ab 两个组件是否 “足够” 近。如果足够近，就吸附在一起。是否足够近要靠一个变量来判断：</p> <p>diff: 3,
复制代码
小于等于 diff 像素则自动吸附。</p> <p>吸附
吸附效果是怎么实现的呢？</p> <p>假设现在有 ab 组件，a 组件坐标 xy 都是 0，宽高都是 100。现在假设 a 组件不动，我们正在拖拽 b 组件。当把 b 组件拖到坐标为 x: 0, y: 103 时，由于 103 - 100 &lt;= 3(diff)，所以可以判定它们已经接近得足够近。这时需要手动将 b 组件的 y 坐标值设为 100，这样就将 ab 组件吸附在一起了。</p> <p>优化
在拖拽时如果 6 条标线都显示出来会不太美观。所以我们可以做一下优化，在纵横方向上最多只同时显示一条线。实现原理如下：</p> <p>a 组件在左边不动，我们拖着 b 组件往 a 组件靠近。
这时它们最先对齐的是 a 的右边和 b 的左边，所以只需要一条线就够了。
如果 ab 组件已经靠近，并且 b 组件继续往左边移动，这时就要判断它们俩的中间是否对齐。
b 组件继续拖动，这时需要判断 a 组件的左边和 b 组件的右边是否对齐，也是只需要一条线。
可以发现，关键的地方是我们要知道两个组件的方向。即 ab 两个组件靠近，我们要知道到底 b 是在 a 的左边还是右边。</p> <p>这一点可以通过鼠标移动事件来判断，之前在讲解拖拽的时候说过，mousedown 事件触发时会记录起点坐标。所以每次触发 mousemove 事件时，用当前坐标减去原来的坐标，就可以判断组件方向。例如 x 方向上，如果 b.x - a.x 的差值为正，说明是 b 在 a 右边，否则为左边。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>eventBus.$emit('move', this.$el, currY - startY &gt; 0, currX - startX &gt; 0)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>复制代码</p> <ol start="8"><li>组件属性设置
每个组件都有一些通用属性和独有的属性，我们需要提供一个能显示和修改属性的地方。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    component: 'v-text', 
    label: '文字', 
    propValue: '文字', 
    icon: 'el-icon-edit', 
    animations: [], 
    events: {}, 
    style: { 
        width: 200,
        height: 33,
        fontSize: 14,
        fontWeight: 500,
        lineHeight: '',
        letterSpacing: 0,
        textAlign: '',
        color: '',
    },
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>复制代码</p> <p>我定义了一个 AttrList 组件，用于显示每个组件的属性。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;template&gt;
    &lt;div&gt;
        &lt;el-form&gt;
            &lt;el-form-item v-for=&quot;(key, index) in styleKeys&quot; :key=&quot;index&quot; :label=&quot;map[key]&quot;&gt;
                &lt;el-color-picker v-if=&quot;key == 'borderColor'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;&lt;/el-color-picker&gt;
                &lt;el-color-picker v-else-if=&quot;key == 'color'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;&lt;/el-color-picker&gt;
                &lt;el-color-picker v-else-if=&quot;key == 'backgroundColor'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;&lt;/el-color-picker&gt;
                &lt;el-select v-else-if=&quot;key == 'textAlign'&quot; v-model=&quot;curComponent.style[key]&quot;&gt;
                    &lt;el-option
                        v-for=&quot;item in options&quot;
                        :key=&quot;item.value&quot;
                        :label=&quot;item.label&quot;
                        :value=&quot;item.value&quot;
                    &gt;&lt;/el-option&gt;
                &lt;/el-select&gt;
                &lt;el-input type=&quot;number&quot; v-else v-model=&quot;curComponent.style[key]&quot; /&gt;
            &lt;/el-form-item&gt;
            &lt;el-form-item label=&quot;内容&quot; v-if=&quot;curComponent &amp;&amp; curComponent.propValue &amp;&amp; !excludes.includes(curComponent.component)&quot;&gt;
                &lt;el-input type=&quot;textarea&quot; v-model=&quot;curComponent.propValue&quot; /&gt;
            &lt;/el-form-item&gt;
        &lt;/el-form&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>复制代码
代码逻辑很简单，就是遍历组件的 style 对象，将每一个属性遍历出来。并且需要根据具体的属性用不同的组件显示出来，例如颜色属性，需要用颜色选择器显示；数值类的属性需要用 type=number 的 input 组件显示等等。</p> <p>为了方便用户修改属性值，我使用 v-model 将组件和值绑定在一起。</p> <ol start="9"><li>预览、保存代码
预览和编辑的渲染原理是一样的，区别是不需要编辑功能。所以只需要将原先渲染组件的代码稍微改一下就可以了。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;Shape v-for=&quot;(item, index) in componentData&quot;
    :defaultStyle=&quot;item.style&quot;
    :style=&quot;getShapeStyle(item.style, index)&quot;
    :key=&quot;item.id&quot;
    :active=&quot;item === curComponent&quot;
    :element=&quot;item&quot;
    :zIndex=&quot;index&quot;
&gt;
    &lt;component
       
        :is=&quot;item.component&quot;
        :style=&quot;getComponentStyle(item.style)&quot;
        :propValue=&quot;item.propValue&quot;
    /&gt;
&lt;/Shape&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>复制代码
经过刚才的介绍，我们知道 Shape 组件具备了拖拽、放大缩小的功能。现在只需要将 Shape 组件去掉，外面改成套一个普通的 DIV 就可以了（其实不用这个 DIV 也行，但为了绑定事件这个功能，所以需要加上）。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;div v-for=&quot;(item, index) in componentData&quot; :key=&quot;item.id&quot;&gt;
    &lt;component
       
        :is=&quot;item.component&quot;
        :style=&quot;getComponentStyle(item.style)&quot;
        :propValue=&quot;item.propValue&quot;
    /&gt;
&lt;/div&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>复制代码
保存代码的功能也特别简单，只需要保存画布上的数据 componentData 即可。保存有两种选择：</p> <p>保存到服务器
本地保存
在 DEMO 上我使用的 localStorage 保存在本地。</p> <ol start="10"><li>绑定事件
每个组件有一个 events 对象，用于存储绑定的事件。目前我只定义了两个事件：</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>alert 事件
redirect 事件
const events = {
    redirect(url) {
        if (url) {
            window.location.href = url
        }
    },

    alert(msg) {
        if (msg) {
            alert(msg)
        }
    },
}

const mixins = {
    methods: events,
}

const eventList = [
    {
        key: 'redirect',
        label: '跳转事件',
        event: events.redirect,
        param: '',
    },
    {
        key: 'alert',
        label: 'alert 事件',
        event: events.alert,
        param: '',
    },
]

export {
    mixins,
    events,
    eventList,
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>复制代码
不过不能在编辑的时候触发，可以在预览的时候触发。</p> <p>添加事件
通过 v-for 指令将事件列表渲染出来：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;el-tabs v-model=&quot;eventActiveName&quot;&gt;
    &lt;el-tab-pane v-for=&quot;item in eventList&quot; :key=&quot;item.key&quot; :label=&quot;item.label&quot; :name=&quot;item.key&quot;&gt;
        &lt;el-input v-if=&quot;item.key == 'redirect'&quot; v-model=&quot;item.param&quot; type=&quot;textarea&quot; placeholder=&quot;请输入完整的 URL&quot; /&gt;
        &lt;el-input v-if=&quot;item.key == 'alert'&quot; v-model=&quot;item.param&quot; type=&quot;textarea&quot; placeholder=&quot;请输入要 alert 的内容&quot; /&gt;
        &lt;el-button @click=&quot;addEvent(item.key, item.param)&quot;&gt;确定&lt;/el-button&gt;
    &lt;/el-tab-pane&gt;
&lt;/el-tabs&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>复制代码
选中事件时将事件添加到组件的 events 对象。</p> <p>触发事件
预览或真正渲染页面时，也需要在每个组件外面套一层 DIV，这样就可以在 DIV 上绑定一个点击事件，点击时触发我们刚才添加的事件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;template&gt;
    &lt;div @click=&quot;handleClick&quot;&gt;
        &lt;component
           
            :is=&quot;config.component&quot;
            :style=&quot;getStyle(config.style)&quot;
            :propValue=&quot;config.propValue&quot;
        /&gt;
    &lt;/div&gt;
&lt;/template&gt;
复制代码
handleClick() {
    const events = this.config.events
    
    Object.keys(events).forEach(event =&gt; {
        this[event](events[event])
    })
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>复制代码
11. 绑定动画
动画和事件的原理是一样的，先将所有的动画通过 v-for 指令渲染出来，然后点击动画将对应的动画添加到组件的 animations 数组里。同事件一样，执行的时候也是遍历组件所有的动画并执行。</p> <p>为了方便，我们使用了 animate.css 动画库。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import '@/styles/animate.css'
复制代码
现在我们提前定义好所有的动画数据：

export default [
    {
        label: '进入',
        children: [
            { label: '渐显', value: 'fadeIn' },
            { label: '向右进入', value: 'fadeInLeft' },
            { label: '向左进入', value: 'fadeInRight' },
            { label: '向上进入', value: 'fadeInUp' },
            { label: '向下进入', value: 'fadeInDown' },
            { label: '向右长距进入', value: 'fadeInLeftBig' },
            { label: '向左长距进入', value: 'fadeInRightBig' },
            { label: '向上长距进入', value: 'fadeInUpBig' },
            { label: '向下长距进入', value: 'fadeInDownBig' },
            { label: '旋转进入', value: 'rotateIn' },
            { label: '左顺时针旋转', value: 'rotateInDownLeft' },
            { label: '右逆时针旋转', value: 'rotateInDownRight' },
            { label: '左逆时针旋转', value: 'rotateInUpLeft' },
            { label: '右逆时针旋转', value: 'rotateInUpRight' },
            { label: '弹入', value: 'bounceIn' },
            { label: '向右弹入', value: 'bounceInLeft' },
            { label: '向左弹入', value: 'bounceInRight' },
            { label: '向上弹入', value: 'bounceInUp' },
            { label: '向下弹入', value: 'bounceInDown' },
            { label: '光速从右进入', value: 'lightSpeedInRight' },
            { label: '光速从左进入', value: 'lightSpeedInLeft' },
            { label: '光速从右退出', value: 'lightSpeedOutRight' },
            { label: '光速从左退出', value: 'lightSpeedOutLeft' },
            { label: 'Y轴旋转', value: 'flip' },
            { label: '中心X轴旋转', value: 'flipInX' },
            { label: '中心Y轴旋转', value: 'flipInY' },
            { label: '左长半径旋转', value: 'rollIn' },
            { label: '由小变大进入', value: 'zoomIn' },
            { label: '左变大进入', value: 'zoomInLeft' },
            { label: '右变大进入', value: 'zoomInRight' },
            { label: '向上变大进入', value: 'zoomInUp' },
            { label: '向下变大进入', value: 'zoomInDown' },
            { label: '向右滑动展开', value: 'slideInLeft' },
            { label: '向左滑动展开', value: 'slideInRight' },
            { label: '向上滑动展开', value: 'slideInUp' },
            { label: '向下滑动展开', value: 'slideInDown' },
        ],
    },
    {
        label: '强调',
        children: [
            { label: '弹跳', value: 'bounce' },
            { label: '闪烁', value: 'flash' },
            { label: '放大缩小', value: 'pulse' },
            { label: '放大缩小弹簧', value: 'rubberBand' },
            { label: '左右晃动', value: 'headShake' },
            { label: '左右扇形摇摆', value: 'swing' },
            { label: '放大晃动缩小', value: 'tada' },
            { label: '扇形摇摆', value: 'wobble' },
            { label: '左右上下晃动', value: 'jello' },
            { label: 'Y轴旋转', value: 'flip' },
        ],
    },
    {
        label: '退出',
        children: [
            { label: '渐隐', value: 'fadeOut' },
            { label: '向左退出', value: 'fadeOutLeft' },
            { label: '向右退出', value: 'fadeOutRight' },
            { label: '向上退出', value: 'fadeOutUp' },
            { label: '向下退出', value: 'fadeOutDown' },
            { label: '向左长距退出', value: 'fadeOutLeftBig' },
            { label: '向右长距退出', value: 'fadeOutRightBig' },
            { label: '向上长距退出', value: 'fadeOutUpBig' },
            { label: '向下长距退出', value: 'fadeOutDownBig' },
            { label: '旋转退出', value: 'rotateOut' },
            { label: '左顺时针旋转', value: 'rotateOutDownLeft' },
            { label: '右逆时针旋转', value: 'rotateOutDownRight' },
            { label: '左逆时针旋转', value: 'rotateOutUpLeft' },
            { label: '右逆时针旋转', value: 'rotateOutUpRight' },
            { label: '弹出', value: 'bounceOut' },
            { label: '向左弹出', value: 'bounceOutLeft' },
            { label: '向右弹出', value: 'bounceOutRight' },
            { label: '向上弹出', value: 'bounceOutUp' },
            { label: '向下弹出', value: 'bounceOutDown' },
            { label: '中心X轴旋转', value: 'flipOutX' },
            { label: '中心Y轴旋转', value: 'flipOutY' },
            { label: '左长半径旋转', value: 'rollOut' },
            { label: '由小变大退出', value: 'zoomOut' },
            { label: '左变大退出', value: 'zoomOutLeft' },
            { label: '右变大退出', value: 'zoomOutRight' },
            { label: '向上变大退出', value: 'zoomOutUp' },
            { label: '向下变大退出', value: 'zoomOutDown' },
            { label: '向左滑动收起', value: 'slideOutLeft' },
            { label: '向右滑动收起', value: 'slideOutRight' },
            { label: '向上滑动收起', value: 'slideOutUp' },
            { label: '向下滑动收起', value: 'slideOutDown' },
        ],
    },
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><p>复制代码
然后用 v-for 指令渲染出来动画列表。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
添加动画
&lt;el-tabs v-model=&quot;animationActiveName&quot;&gt;
    &lt;el-tab-pane v-for=&quot;item in animationClassData&quot; :key=&quot;item.label&quot; :label=&quot;item.label&quot; :name=&quot;item.label&quot;&gt;
        &lt;el-scrollbar&gt;
            &lt;div
               
                v-for=&quot;(animate, index) in item.children&quot;
                :key=&quot;index&quot;
                @mouseover=&quot;hoverPreviewAnimate = animate.value&quot;
                @click=&quot;addAnimation(animate)&quot;
            &gt;
                &lt;div :class=&quot;[hoverPreviewAnimate === animate.value &amp;&amp; animate.value + ' animated']&quot;&gt;
                    {{ animate.label }}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/el-scrollbar&gt;
    &lt;/el-tab-pane&gt;
&lt;/el-tabs&gt;
复制代码
点击动画将调用 addAnimation(animate) 将动画添加到组件的 animations 数组。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>触发动画
运行动画的代码：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>export default async function runAnimation($el, animations = []) {
    const play = (animation) =&gt; new Promise(resolve =&gt; {
        $el.classList.add(animation.value, 'animated')
        const removeAnimation = () =&gt; {
            $el.removeEventListener('animationend', removeAnimation)
            $el.removeEventListener('animationcancel', removeAnimation)
            $el.classList.remove(animation.value, 'animated')
            resolve()
        }
            
        $el.addEventListener('animationend', removeAnimation)
        $el.addEventListener('animationcancel', removeAnimation)
    })

    for (let i = 0, len = animations.length; i &lt; len; i++) {
        await play(animations[i])
    }
}
复制代码
运行动画需要两个参数：组件对应的 DOM 元素（在组件使用 this.$el 获取）和它的动画数据 animations。并且需要监听 animationend 事件和 animationcancel 事件：一个是动画结束时触发，一个是动画意外终止时触发。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>利用这一点再配合 Promise 一起使用，就可以逐个运行组件的每个动画了。</p> <ol start="12"><li>导入 PSD
由于时间关系，这个功能我还没做。现在简单的描述一下怎么做这个功能。那就是使用 psd.js 库，它可以解析 PSD 文件。</li></ol> <p>使用 psd 库解析 PSD 文件得出的数据如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{ children: 
   [ { type: 'group',
       visible: false,
       opacity: 1,
       blendingMode: 'normal',
       name: 'Version D',
       left: 0,
       right: 900,
       top: 0,
       bottom: 600,
       height: 600,
       width: 900,
       children: 
        [ { type: 'layer',
            visible: true,
            opacity: 1,
            blendingMode: 'normal',
            name: 'Make a change and save.',
            left: 275,
            right: 636,
            top: 435,
            bottom: 466,
            height: 31,
            width: 361,
            mask: {},
            text: 
             { value: 'Make a change and save.',
               font: 
                { name: 'HelveticaNeue-Light',
                  sizes: [ 33 ],
                  colors: [ [ 85, 96, 110, 255 ] ],
                  alignment: [ 'center' ] },
               left: 0,
               top: 0,
               right: 0,
               bottom: 0,
               transform: { xx: 1, xy: 0, yx: 0, yy: 1, tx: 456, ty: 459 } },
            image: {} } ] } ],
    document: 
       { width: 900,
         height: 600,
         resources: 
          { layerComps: 
             [ { id: 692243163, name: 'Version A', capturedInfo: 1 },
               { id: 725235304, name: 'Version B', capturedInfo: 1 },
               { id: 730932877, name: 'Version C', capturedInfo: 1 } ],
            guides: [],
            slices: [] } } }
复制代码
从以上代码可以发现，这些数据和 css 非常像。根据这一点，只需要写一个转换函数，将这些数据转换成我们组件所需的数据，就能实现 PSD 文件转成渲染组件的功能。目前 quark-h5 和 luban-h5 都是这样实现的 PSD 转换功能。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><ol start="13"><li>手机模式
由于画布是可以调整大小的，我们可以使用 iphone6 的分辨率来开发手机页面。</li></ol> <p>这样开发出来的页面也可以在手机下正常浏览，但可能会有样式偏差。因为我自定义的三个组件是没有做适配的，如果你需要开发手机页面，那自定义组件必须使用移动端的 UI 组件库。或者自己开发移动端专用的自定义组件。</p> <p>总结
由于 DEMO 的代码比较多，所以在讲解每一个功能点时，我只把关键代码贴上来。所以大家会发现 DEMO 的源码和我贴上来的代码会有些区别，请不必在意。</p> <p>另外，DEMO 的样式也比较简陋，主要是最近事情比较多，没太多时间写好看点，请见谅。</p> <p>参考资料
ref-line
quark-h5
luban-h5
易企秀
drag 事件
全文完</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2022/1/10 下午4:07:35</span></div></footer> <!----> </main> <div class="footer-wrapper footer"><span><a href="https://toutiao.zhangfan.vip">小张头条</a></span> <!----></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.59705b41.js" defer></script><script src="/assets/js/2.a6173bc2.js" defer></script><script src="/assets/js/23.f6407bd5.js" defer></script>
  </body>
</html>
